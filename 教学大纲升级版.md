# 《大模型多智能体系统：智慧校园全栈实战》实训教学大纲（升级版）

**课程周期：** 10 - 14 天（强化实训，可根据学生基础灵活调整 Day6-8 的实操时长）  
**适用对象：** 计算机、人工智能相关专业大三/大四学生（前置基础：Python 基础、简单 SQL 语句、Git 基本使用，无前置基础可增加 0.5 天前置基础扫盲）  
**实训主题：** 基于 LangGraph 的多智能体协作系统开发与云端交付  
**核心目标：** 从“技术使用”到“工程落地”，培养学生的**多智能体架构设计能力**、**异构数据融合能力**、**协议对接能力**和**企业级 CICD 交付能力**，最终完成一个可上线、可交互的智慧校园多智能体问答/办事系统。

---

## 一、实训目标（分层拆解，适配教学评价）

### 基础目标（全员掌握，占考核 60%）

1. 掌握 LangGraph 的核心概念（状态机、节点、边、Checkpointer），能实现简单的多智能体顺序/条件编排；
2. 会操作 Supabase/Neo4j/Chroma 三种异构数据库，能完成基础的数据写入、查询、关联检索；
3. 理解 MCP 协议的核心思想，能调用现成的 MCP Server/API 实现工具对接，完成校园导航等基础功能；
4. 掌握 Git Flow 工作流、GitHub Actions 基础配置和 Vercel 一键部署，能将项目发布至公网预览地址。

### 进阶目标（部分掌握，占考核 30%）

1. 能根据业务需求设计多智能体的角色分工和动态路由逻辑，解决“智慧校园”中的实际业务问题（如报到闭环、政策咨询）；
2. 能优化异构数据的检索效率（如 RAG 语义切分优化、Neo4j 多跳查询优化、Supabase 索引设计）；
3. 能自定义开发简单的 MCP Server，实现自研业务系统与大模型的对接；
4. 能实现系统的基础优化（如断点续传、流式渲染、隐私护栏）。

### 拔高目标（选做，占考核 10%）

1. 能针对多智能体系统的瓶颈做性能调优（如节点并行执行、状态缓存、检索结果重排序）；
2. 能完善 CICD 流水线（如添加单元测试、代码覆盖率检查、环境隔离部署）；
3. 能扩展系统功能（如多轮对话记忆、多用户权限管理、智能体错误重试机制）。

---

## 二、实训大纲（按天规划，**优化实操步骤 + 补充教学要点 + 增加排错环节**）

### 前置准备（0.5 天，可选，针对无前置基础学生）

1. **环境配置**：Python 3.9+、Anaconda/虚拟环境、Git、Docker（简化数据库部署）、VSCode+插件；
2. **基础扫盲**：Python 函数/类、简单 SQL 语句、Git clone/commit/push/branch、FastAPI 基础运行；
3. **工具准备**：LangSmith 账号、GitHub 账号、Supabase 账号、Neo4j Aura/Chroma Cloud（提供免费额度）。

---

### 第一阶段：基础设施与异构数据构建 (Day 1–3)

**核心目标：** 搭好项目工程骨架，完成三种异构数据库的基础部署和数据入库，实现“数据层”的搭建。

#### Day 1: 项目启动与工程化初探（**补充 Docker 化部署，降低环境问题**）

- **理论（2h）**
  1. 多智能体系统（MAS）核心设计模式（分工协作、主从编排、动态路由）；
  2. 分布式系统中的状态管理核心问题（数据一致性、状态丢失、多端同步）；
  3. 工程化开发规范：Git Flow 工作流（主干/开发/特性/发布分支）、项目目录结构设计（前后端分离、分层架构）。
- **实操（6h，分步骤落地，配沙盒模板）**
  1. 项目初始化：基于模板创建仓库，配置 Python 虚拟环境/依赖（`requirements.txt`/`pyproject.toml`），设计标准项目目录（`api/`/`agents/`/`db/`/`utils/`）；
  2. Git 配置：创建 `dev`/`feature` 分支，配置 `.gitignore`，编写 Commit 规范（Conventional Commits）；
  3. 云端环境初始化：创建 Supabase 项目，关联 GitHub 仓库，配置 Supabase 云数据库（一键创建，免本地部署）；
  4. 基础测试：编写简单的 Python 脚本，实现本地与 Supabase 的连接测试，完成第一条数据插入/查询。
- **教学要点**：
  1. **虚拟环境是必选项**：强调每个项目都必须使用虚拟环境（venv），避免依赖冲突；
  2. 重点解决学生的**环境配置问题**，提供现成的仓库模板和依赖文件；
  3. 强调项目目录结构的重要性，为后续多模块开发做铺垫。
- **课后作业**：提交 Git 仓库地址，完成 PostgreSQL 连接测试截图，推送到 `feature/day1` 分支并创建 PR。

#### Day 2: 知识获取（RAG + 向量库）（**补充语义切分实操 + RAG 基础评估**）

- **理论（2h）**
  1. RAG 的核心流程（加载-切分-向量化-存储-检索-生成）；
  2. 混合检索策略（关键词检索+语义检索）、语义切分原则（按语义完整性、固定长度+重叠窗口）；
  3. Chroma DB 的核心特性（轻量级、嵌入式、支持本地/云端部署）、Embedding 模型的选择（开源轻量模型如 BGE-m3，适配实训）。
- **实操（6h，基于 LangChain 完成端到端 RAG）**
  1. 数据处理：使用 LangChain 的 `PyPDFLoader`/`UnstructuredLoader` 处理《校园报到手册》（PDF/Word），完成文本清洗、语义切分；
  2. 向量化与存储：调用开源 Embedding 模型生成向量，将文本+向量+元数据存入 Chroma（本地/云端）；
  3. 基础检索：实现语义检索、关键词检索、混合检索，对比不同检索方式的结果差异；
  4. RAG 基础评估：手动验证召回准确率，调整切分参数和检索策略。
- **教学要点**：重点讲解**语义切分的坑**（如切分后语义断裂），提供现成的文本处理工具类；推荐使用**本地 Chroma** 降低学生的云端配置成本。
- **课后作业**：完成《校园报到手册》的 RAG 系统搭建，实现任意问题的检索，提交检索结果截图。

#### Day 3: 复杂关系处理（知识图谱 Neo4j）（**补充图建模实操 + Text-to-Cypher 避坑**）

- **理论（2h）**
  1. 图数据库核心概念（点 Node/边 Relationship/属性 Property），与关系型数据库的区别；
  2. 智慧校园场景的图建模原则（实体抽象、关系定义、属性设计）；
  3. Text-to-Cypher 原理（大模型将自然语言转为 Cypher 语句）、核心问题（语句错误、查询效率低、死循环）。
- **实操（6h，从建模到查询的端到端实现）**
  1. Neo4j 环境部署：使用 Neo4j Aura（免费云实例）或 Docker 本地部署，完成连接配置；
  2. 图建模与数据入库：抽象校园核心实体（学生/教师/实验室/课程/院系），定义实体关系（隶属/授课/入驻/选修），编写 Cypher 脚本导入仿真数据；
  3. 基础查询：实现单跳/多跳查询（如“查询计算机学院张老师的实验室里的学生”）；
  4. Text-to-Cypher 实现：基于 LangChain 搭建 Text-to-Cypher 系统，添加语句校验和错误重试，避免死循环；
  5. 跨库关联：实现 Chroma（非结构化）与 Neo4j（结构化关系）的简单混合检索。
- **教学要点**：重点讲解**图建模的合理性**（避免实体冗余、关系混乱），提供智慧校园的标准图模型和 Cypher 导入脚本；针对 Text-to-Cypher，添加**基础的语句过滤**（如禁止 DELETE/DROP 语句）。
- **课后作业**：完成校园知识图谱的搭建，实现 3 个以上的多跳查询，提交 Neo4j 可视化截图和 Text-to-Cypher 测试结果。

---

### 第二阶段：LangGraph 核心引擎与智能体构建 (Day 4–8)

**核心目标：** 完成 LangGraph 全栈能力训练，覆盖从 ReAct Agent 到高级中间件、并行、MCP、监督者等 13 项核心知识点。

#### Day 4: 快速入门与工具集封装（知识点 #1, #7）

- **理论（2h）**
  1. **快速入门 (#1)**：创建你的第一个 ReAct Agent；
  2. **MCP Server (#7)**：理解 MCP 协议及其在智能体系统中的应用。
- **实操（6h）**
  1. 上午：创建一个简单的 ReAct Agent，通过模拟 API 调用获取信息；
  2. 下午：开发极简版 MCP Server（基于 FastAPI），并与 Agent 集成。
- **产出**：一个遵循 MCP 协议的校园导航服务。

#### Day 5: 状态图与上下文工程（知识点 #2, #6）

- **理论（2h）**
  1. **状态图 (#2)**：使用 `StateGraph` 创建工作流；
  2. **上下文工程 (#6)**：使用 `State`, `Store`, `Runtime` 管理上下文。
- **实操（6h）**
  1. 使用 `StateGraph` 重构 Agent，设计强类型的 `CampusState`；
  2. 实践上下文管理，确保多轮对话一致性。
- **产出**：一个基于 `StateGraph` 的智能体骨架。

#### Day 6: 记忆、中间件与人机交互（知识点 #5, #3, #4）

- **理论（2h）**
  1. **记忆 (#5)**：创建短期记忆、长期记忆；
  2. **中间件 (#3)**：实现预算控制、消息截断、敏感词过滤、PII 检测；
  3. **人机交互 (#4)**：使用 HITL 中间件实现人工干预。
- **实操（6h）**
  1. 实现长短记忆；
  2. 开发自定义中间件；
  3. 在关键节点（如支付确认）暂停流程，等待人工确认。
- **产出**：一个安全、可控、支持人工干预的智能体。

#### Day 7: 监督者模式与并行（知识点 #8, #9）

- **理论（2h）**
  1. **监督者模式 (#8)**：tool-calling 与 langgraph-supervisor；
  2. **并行 (#9)**：节点并发、@task、Map-reduce、Sub-graphs。
- **实操（6h）**
  1. 实现 `SupervisorAgent`，负责调度专业 Agent；
  2. 实现并行执行（如同时查缴费、宿舍、课表）。
- **产出**：一个高效的多智能体协作架构。

#### Day 8: 网络搜索与 Deep Agents（知识点 #11, #12）

- **理论（2h）**
  1. **网络搜索 (#11)**：集成 DashScope/Tavily/DDGS；
  2. **Deep Agents (#12)**：简介 CrewAI 等框架。
- **实操（6h）**
  1. 实现联网搜索（如“附近有什么好吃的？”）；
  2. 对比 LangGraph 与 Deep Agents 的开发体验。
- **产出**：一个具备实时信息获取能力的智能体。

---

### 第三阶段：应用交付与体验优化 (Day 9–10)

**核心目标：** 完成前端界面开发与后端流式通信，实现 CICD 自动化流水线和云端部署。

#### Day 9: Gradio APP 开发（知识点 #13）

- **理论（2h）**
  1. **Gradio APP (#13)**：基于 Gradio 开发流式对话智能体应用。
- **实操（6h）**
  1. 使用 Gradio 开发流式对话界面，集成 SSE 和思考链展示。
- **产出**：一个功能完备、交互流畅的 Gradio Web 应用。

#### Day 10: CICD 自动化与部署

- **理论（2h）**
  1. 持续集成/持续部署（CICD）核心原则；
  2. GitHub Actions 与 Vercel/Spaces 部署优势。
- **实操（6h）**
  1. 配置 GitHub Actions 实现自动化部署；
  2. 将 Gradio 应用部署至 Hugging Face Spaces 或 Vercel。
- **产出**：一个可公开访问的生产级智慧校园智能体应用。

---

### 拓展阶段（Day 11–14，可选）

- **深度整合**：融合所有 LangGraph 高级特性；
- **性能压测**：验证中间件有效性；
- **CrewAI 探索**：尝试使用 CrewAI 重构部分模块。

---

## 三、核心架构技术栈 (Tech Stack)

| 维度 | 技术选型 | 备注 |
|------|----------|------|
| **逻辑引擎** | LangGraph + LangChain | 推荐 LangChain-Core 轻量版 |
| **持久化存储** | Supabase | 一站式存储业务表、记忆、Checkpoints |
| **非结构化搜索** | Chroma DB (RAG) | 本地 Chroma（实训首选） |
| **关系推理** | Neo4j | Neo4j Aura（免费云实例） |
| **工具连接** | MCP (FastAPI) + 第三方 API | 极简 MCP Server，对接地图 API |
| **后端框架** | FastAPI | 支持 SSE、Swagger |
| **前端框架** | Gradio | 快速开发流式对话界面 |
| **部署交付** | Supabase + Vercel / Hugging Face Spaces | 数据库 + 前后端一体化部署 |
| **流水线** | GitHub Actions | 提供现成 Workflow 模板 |
| **辅助工具** | LangSmith | 调试智能体决策链 |

---

## 四、项目考核与评价标准

### 1. 业务功能（50 分）

| 考核点 | 分值 | 考核标准 |
|--------|------|----------|
| 报到流闭环 | 20 | 公网环境完整走通 3 次以上 |
| 数据准确度 | 15 | RAG 召回 ≥80%，Neo4j 查询准确 |
| 断点续传 | 15 | 刷新后恢复状态，5 次均成功 |

### 2. 工程规范（30 分）

| 考核点 | 分值 | 考核标准 |
|--------|------|----------|
| 数据库规范 | 10 | 表/图设计合理，查询高效 |
| Git & CICD | 10 | Git Flow 规范，CICD 自动运行 |
| 代码规范 | 10 | PEP8 合规，注释清晰 |

### 3. 系统性能与安全（20 分）

| 考核点 | 分值 | 考核标准 |
|--------|------|----------|
| 响应延迟 | 10 | 端到端 ≤3s（10 问中 ≥8 问达标） |
| 安全性 | 10 | 实现敏感词/PII 过滤，密钥通过环境变量管理 |

### 4. 拔高加分项（10 分，可选）

- 节点并行/检索优化，延迟 ≤2s（+3）
- 自研 MCP Server（+3）
- 完善 CICD（覆盖率/多环境）（+2）
- 功能扩展（语音/权限/公告）（+2）

---

## 五、教学资源配套

1. **实训沙盒**：提供 State、中间件、MCP、Gradio 等模板；
2. **仿真数据**：含学生信息、校园手册、导航数据、对话历史；
3. **调试工具**：LangSmith 教程 + 测试用例库；
4. **教学资料**：PPT、实操视频、技术笔记、排错手册；
5. **成果模板**：演示 PPT、说明文档、视频脚本。

---

## 六、教学实施建议

1. **分组实操**：2–3 人/组，分工（后端/智能体、前端、数据库/部署）；
2. **对比教学**：Day 8 后组织对比“确定性工作流” vs “自主规划智能体”；
3. **渐进挑战**：基础目标保底，进阶/拔高目标激励优秀学生。