**è¯¾ç¨‹å‘¨æœŸ**ï¼š10 å¤©ï¼ˆæ ¸å¿ƒå®è®­ï¼‰

**é€‚ç”¨å¯¹è±¡**ï¼šè®¡ç®—æœº / AI ç›¸å…³ä¸“ä¸šå¤§ä¸‰ / å¤§å››å­¦ç”Ÿï¼ˆå‰ç½®åŸºç¡€ï¼šPython åŸºç¡€ã€ç®€å• SQLã€Git åŸºæœ¬ä½¿ç”¨ï¼‰

**æ ¸å¿ƒäº¤ä»˜**ï¼šå¯å…¬ç½‘è®¿é—®çš„æ™ºæ…§æ ¡å›­å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆVercel éƒ¨ç½²ï¼‰

---

## Day 1ï¼šé¡¹ç›®å¯åŠ¨ä¸å·¥ç¨‹åŒ–åˆæ¢

**ä¸€ã€å‰æœŸçŸ¥è¯†ï¼ˆè¯¾å‰é¢„ä¹ ï¼Œ1hï¼‰**

1. Git åŸºç¡€æ“ä½œï¼ˆclone/commit/push/branchï¼‰ï¼›
2. å‰åç«¯åˆ†ç¦»é¡¹ç›®çš„ç›®å½•ç»“æ„è®¾è®¡ï¼›
3. äº‘æ•°æ®åº“ï¼ˆSupabaseï¼‰çš„åŸºæœ¬æ¦‚å¿µï¼ˆé¡¹ç›® / è¡¨ / è¿æ¥ï¼‰ã€‚

**äºŒã€å®éªŒç›®æ ‡**

1. æŒæ¡ä¼ä¸šçº§é¡¹ç›®çš„å·¥ç¨‹åŒ–è§„èŒƒï¼ˆGit Flowã€ç›®å½•ç»“æ„ï¼‰ï¼›
2. å®Œæˆé¡¹ç›®åˆå§‹åŒ–ä¸äº‘ç«¯ç¯å¢ƒï¼ˆSupabaseï¼‰æ­å»ºï¼›
3. å®ç°æœ¬åœ°ä¸äº‘ç«¯æ•°æ®åº“çš„è¿æ¥ä¸åŸºç¡€æ•°æ®æ“ä½œã€‚

**ä¸‰ã€éš¾ç‚¹é‡ç‚¹**

- **é‡ç‚¹**ï¼šGit Flow å·¥ä½œæµè½åœ°ã€é¡¹ç›®ç›®å½•ç»“æ„è®¾è®¡ã€äº‘æ•°æ®åº“è¿æ¥ï¼›
- **éš¾ç‚¹**ï¼šSupabase ç¯å¢ƒé…ç½®ã€æ•°æ®åº“è¿æ¥å‚æ•°è°ƒè¯•ï¼ˆé¿å…å› ç½‘ç»œ / æƒé™å¯¼è‡´è¿æ¥å¤±è´¥ï¼‰ã€‚

**å››ã€çŸ¥è¯†åŸºç¡€**

- å¿…å¤‡ï¼šPython è™šæ‹Ÿç¯å¢ƒä½¿ç”¨ï¼ˆvenv/condaï¼‰ã€SQL åŸºæœ¬æŸ¥è¯¢è¯­å¥ï¼›
- å¯é€‰ï¼šFastAPI åŸºç¡€ï¼ˆæ— éœ€æ·±å…¥ï¼Œäº†è§£æ¥å£æ¦‚å¿µå³å¯ï¼‰ã€‚

**äº”ã€å®éªŒæ­¥éª¤ï¼ˆ8hï¼Œå« 2h ç†è®ºè®²è§£ï¼‰**

**é˜¶æ®µ 1ï¼šç†è®ºè®²è§£ï¼ˆ2hï¼‰**

1. å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆMASï¼‰æ ¸å¿ƒè®¾è®¡æ¨¡å¼ï¼ˆ15minï¼‰ï¼›
2. åˆ†å¸ƒå¼çŠ¶æ€ç®¡ç†æ ¸å¿ƒé—®é¢˜ï¼ˆ15minï¼‰ï¼›
3. å·¥ç¨‹åŒ–è§„èŒƒï¼šGit Flowï¼ˆä¸»å¹² / å¼€å‘ / ç‰¹æ€§åˆ†æ”¯ï¼‰ã€Commit è§„èŒƒï¼ˆConventional Commitsï¼‰ï¼ˆ30minï¼‰ï¼›
4. é¡¹ç›®ç›®å½•ç»“æ„è®¾è®¡ï¼ˆå‰åç«¯åˆ†ç¦»ã€åˆ†å±‚æ¶æ„ï¼‰ï¼ˆ30minï¼‰ï¼›
5. Supabase äº‘ç¯å¢ƒæ­å»ºæµç¨‹æ¼”ç¤ºï¼ˆ30minï¼‰ã€‚

**é˜¶æ®µ 2ï¼šå®æ“è½åœ°ï¼ˆ6hï¼‰**

**æ­¥éª¤ 1ï¼šé¡¹ç›®åˆå§‹åŒ–ï¼ˆ1.5hï¼‰**

1. ä»å®è®­æ²™ç›’æ¨¡æ¿åˆ›å»º GitHub ä»“åº“ï¼ˆæä¾›æ¨¡æ¿åœ°å€ï¼‰ï¼›
2. å…‹éš†ä»“åº“åˆ°æœ¬åœ°ï¼›

3. **åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒï¼ˆé‡è¦ï¼ï¼‰**ï¼š

   è™šæ‹Ÿç¯å¢ƒç”¨äºéš”ç¦»é¡¹ç›®ä¾èµ–ï¼Œé¿å…ä¸ç³»ç»Ÿ Python ç¯å¢ƒå†²çªã€‚

   ```bash
   # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
   python -m venv venv
   ```

   æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š

   ```bash
   # Windows
   venv\Scripts\activate

   # Mac/Linux
   source venv/bin/activate
   ```

   æ¿€æ´»æˆåŠŸåï¼Œå‘½ä»¤è¡Œå‰ä¼šæ˜¾ç¤º `(venv)` æ ‡è¯†ã€‚

4. **å®‰è£…ä¾èµ–**ï¼š

   ```bash
   pip install -r requirements.txt
   ```

   ä¸»è¦ä¾èµ–åŒ…ï¼šsupabaseã€psycopg2-binaryã€fastapiã€uvicornã€python-dotenv

5. æŒ‰æ ‡å‡†ç›®å½•ç»“æ„åˆ›å»ºæ–‡ä»¶å¤¹ï¼šapi/ï¼ˆæ¥å£ï¼‰ã€agents/ï¼ˆæ™ºèƒ½ä½“ï¼‰ã€db/ï¼ˆæ•°æ®åº“ï¼‰ã€utils/ï¼ˆå·¥å…·å‡½æ•°ï¼‰ã€.envï¼ˆç¯å¢ƒå˜é‡ï¼‰ã€‚

**æ­¥éª¤ 2ï¼šGit é…ç½®ï¼ˆ1hï¼‰**

1. åˆ›å»ºå¼€å‘åˆ†æ”¯ï¼šgit checkout -b devï¼Œå†åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼šgit checkout -b feature/day1ï¼›
2. é…ç½®.gitignoreæ–‡ä»¶ï¼ˆæ·»åŠ venv/ã€.envã€__pycache__/ç­‰ï¼‰ï¼›
3. ç¼–å†™ Commit è§„èŒƒç¤ºä¾‹ï¼ˆå¦‚ï¼šfeat: åˆå§‹åŒ–é¡¹ç›®ç›®å½•ç»“æ„ã€docs: æ·»åŠ READMEè¯´æ˜ï¼‰ã€‚

**æ­¥éª¤ 3ï¼šäº‘ç«¯ç¯å¢ƒæ­å»ºï¼ˆ1.5hï¼‰**

1. æ³¨å†Œ / ç™»å½• Supabase è´¦å·ï¼ˆhttps://supabase.comï¼‰ï¼›
2. åˆ›å»ºæ–°é¡¹ç›®ï¼Œè®°å½•è¿æ¥ä¿¡æ¯ï¼ˆSUPABASE_URLã€SUPABASE_KEYã€SUPABASE_DB_URLï¼‰ï¼›
3. åœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•åˆ›å»º.envæ–‡ä»¶ï¼Œç²˜è´´è¿æ¥ä¿¡æ¯ï¼š

```
SUPABASE_URL="https://your-project.supabase.co"
SUPABASE_KEY="your-anon-key"
SUPABASE_DB_URL="postgresql://postgres:[password]@db.your-project.supabase.co:5432/postgres"
```

**æ­¥éª¤ 4ï¼šæ•°æ®åº“è¿æ¥æµ‹è¯•ï¼ˆ1.5hï¼‰**

1. åœ¨db/ç›®å½•ä¸‹åˆ›å»º[connect.py](http://connect.py/)ï¼Œç¼–å†™ Supabase è¿æ¥ä»£ç ï¼š

```python
import os
from dotenv import load_dotenv
from supabase import create_client

load_dotenv()


def connect_supabase():
    """è¿æ¥ Supabase æ•°æ®åº“å¹¶æ‰§è¡ŒåŸºç¡€æµ‹è¯•"""
    try:
        # åˆ›å»º Supabase å®¢æˆ·ç«¯
        supabase = create_client(
            os.getenv("SUPABASE_URL"),
            os.getenv("SUPABASE_KEY")
        )
        print("âœ… Supabase è¿æ¥æˆåŠŸï¼")
        
        # æµ‹è¯•æŸ¥è¯¢
        response = supabase.table('test').select("*").execute()
        print("ğŸ“Š æŸ¥è¯¢ç»“æœ:", response.data)
        
        return True
    except Exception as e:
        print(f"âŒ è¿æ¥å¤±è´¥: {e}")
        return False


if __name__ == "__main__":
    connect_supabase()
```

1. è¿è¡Œè„šæœ¬ï¼špython db/[connect.py](http://connect.py/)ï¼Œç¡®ä¿è¾“å‡º â€œSupabase è¿æ¥æˆåŠŸâ€ åŠæŸ¥è¯¢ç»“æœï¼›
2. è‹¥å¤±è´¥ï¼ŒæŒ‰é”™è¯¯æç¤ºè°ƒè¯•ï¼ˆå¦‚ï¼šæ£€æŸ¥è¿æ¥åœ°å€ã€API Keyã€ä¾èµ–å®‰è£…ï¼‰ã€‚

**æ­¥éª¤ 5ï¼šä»£ç æäº¤ä¸ PRï¼ˆ0.5hï¼‰**

1. æäº¤ä»£ç ï¼šgit add . â†’ git commit -m "feat: å®Œæˆé¡¹ç›®åˆå§‹åŒ–ä¸Supabaseè¿æ¥æµ‹è¯•"ï¼›
2. æ¨é€åˆ†æ”¯ï¼šgit push origin feature/day1ï¼›
3. åœ¨ GitHub ä»“åº“åˆ›å»º Pull Requestï¼ˆbase: devï¼Œcompare: feature/day1ï¼‰ï¼Œå¡«å†™ PR è¯´æ˜ã€‚

**å…­ã€è€ƒæ ¸æ–¹æ³•ï¼ˆé‡åŒ–è¯„åˆ†ï¼Œ10 åˆ†ï¼‰**

| è€ƒæ ¸é¡¹ | åˆ†å€¼ | è¯„åˆ†æ ‡å‡† |
| --- | --- | --- |
| è™šæ‹Ÿç¯å¢ƒé…ç½® | 2 åˆ† | æˆåŠŸåˆ›å»ºå¹¶æ¿€æ´» venvï¼Œå‘½ä»¤è¡Œæ˜¾ç¤º (venv) æ ‡è¯†ï¼Œä¾èµ–å®‰è£…æ— æŠ¥é”™ |
| é¡¹ç›®ç›®å½•ç»“æ„ | 2 åˆ† | ç¬¦åˆæ ‡å‡†ç»“æ„ï¼ˆapi/agents/db/utilsï¼‰ï¼Œæ— å†—ä½™æ–‡ä»¶ |
| Git é…ç½® | 3 åˆ† | åˆ†æ”¯åˆ›å»ºæ­£ç¡®ï¼ˆdev/feature/day1ï¼‰ï¼Œ.gitignore é…ç½®åˆç†ï¼ŒCommit è§„èŒƒ |
| æ•°æ®åº“è¿æ¥ | 3 åˆ† | æˆåŠŸè¿è¡Œ connect.pyï¼Œè¾“å‡º Supabase è¿æ¥æˆåŠŸåŠæŸ¥è¯¢ç»“æœï¼Œæ— æŠ¥é”™ |
| åŠ åˆ†é¡¹ | 1 åˆ† | æäº¤ PR å¹¶å¡«å†™è§„èŒƒè¯´æ˜ï¼Œä»£ç æ³¨é‡Šæ¸…æ™° |

---

## Day 2ï¼šçŸ¥è¯†è·å–ï¼ˆRAG + å‘é‡åº“ï¼‰

**ä¸€ã€å‰æœŸçŸ¥è¯†ï¼ˆè¯¾å‰é¢„ä¹ ï¼Œ1hï¼‰**

1. RAG æ ¸å¿ƒæµç¨‹ï¼ˆåŠ è½½ - åˆ‡åˆ† - å‘é‡åŒ– - å­˜å‚¨ - æ£€ç´¢ï¼‰ï¼›
2. å‘é‡åº“çš„åŸºæœ¬æ¦‚å¿µï¼ˆEmbeddingã€ç›¸ä¼¼åº¦åŒ¹é…ï¼‰ï¼›
3. LangChain çš„åŸºç¡€ç»„ä»¶ï¼ˆLoaderã€Splitterã€Embeddingsï¼‰ã€‚

**äºŒã€å®éªŒç›®æ ‡**

1. æŒæ¡è¯­ä¹‰åˆ‡åˆ†çš„åŸåˆ™ä¸å®æ“æ–¹æ³•ï¼›
2. å®ç°åŸºäº Chroma çš„å‘é‡åº“æ„å»ºï¼ˆæ–‡æœ¬åŠ è½½â†’å‘é‡åŒ–â†’å­˜å‚¨ï¼‰ï¼›
3. å®ŒæˆåŸºç¡€ RAG æ£€ç´¢ï¼ˆè¯­ä¹‰ / å…³é”®è¯ / æ··åˆæ£€ç´¢ï¼‰å¹¶éªŒè¯æ•ˆæœã€‚

**ä¸‰ã€éš¾ç‚¹é‡ç‚¹**

- **é‡ç‚¹**ï¼šè¯­ä¹‰åˆ‡åˆ†å‚æ•°è°ƒæ•´ã€Embedding æ¨¡å‹é€‰æ‹©ã€RAG æ£€ç´¢æµç¨‹ï¼›
- **éš¾ç‚¹**ï¼šè¯­ä¹‰åˆ‡åˆ†åè¯­ä¹‰å®Œæ•´æ€§ä¿è¯ã€æ£€ç´¢ç»“æœå‡†ç¡®ç‡ä¼˜åŒ–ã€‚

**å››ã€çŸ¥è¯†åŸºç¡€**

- å¿…å¤‡ï¼šPython æ–‡ä»¶æ“ä½œã€JSON / å­—å…¸å¤„ç†ï¼›
- å¯é€‰ï¼šNLP åŸºç¡€ï¼ˆè¯å‘é‡æ¦‚å¿µï¼Œæ— éœ€æ·±å…¥ï¼‰ã€‚

**äº”ã€å®éªŒæ­¥éª¤ï¼ˆ8hï¼Œå« 2h ç†è®ºè®²è§£ï¼‰**

**é˜¶æ®µ 1ï¼šç†è®ºè®²è§£ï¼ˆ2hï¼‰**

1. RAG å…¨æµç¨‹è§£æï¼ˆåŠ è½½ - åˆ‡åˆ† - å‘é‡åŒ– - å­˜å‚¨ - æ£€ç´¢ - ç”Ÿæˆï¼‰ï¼ˆ30minï¼‰ï¼›
2. è¯­ä¹‰åˆ‡åˆ†åŸåˆ™ï¼šchunk_size/chunk_overlap é…ç½®é€»è¾‘ï¼Œé¿å…è¯­ä¹‰æ–­è£‚ï¼ˆ30minï¼‰ï¼›
3. æ··åˆæ£€ç´¢ç­–ç•¥ï¼šå…³é”®è¯æ£€ç´¢ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰+ è¯­ä¹‰æ£€ç´¢ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰ï¼ˆ20minï¼‰ï¼›
4. Chroma DB ç‰¹æ€§ä¸ LangChain é›†æˆæ–¹æ³•ï¼ˆ20minï¼‰ï¼›
5. å¼€æº Embedding æ¨¡å‹é€‰æ‹©ï¼ˆBGE-m3ï¼Œè½»é‡é«˜æ•ˆé€‚é…å®è®­ï¼‰ï¼ˆ20minï¼‰ã€‚

**é˜¶æ®µ 2ï¼šå®æ“è½åœ°ï¼ˆ6hï¼‰**

**æ­¥éª¤ 1ï¼šç¯å¢ƒå‡†å¤‡ï¼ˆ1hï¼‰**

1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£…æ–°å¢ä¾èµ–ï¼špip install langchain langchain-core langchain-community chromadb sentence-transformers python-dotenvï¼›
2. ä¸‹è½½å®è®­æä¾›çš„ã€Šæ ¡å›­æŠ¥åˆ°æ‰‹å†Œã€‹ï¼ˆPDF æ–‡ä»¶ï¼‰ï¼Œæ”¾å…¥data/ç›®å½•ï¼ˆæ–°å»º data æ–‡ä»¶å¤¹ï¼‰ã€‚

**æ­¥éª¤ 2ï¼šæ–‡æœ¬åŠ è½½ä¸è¯­ä¹‰åˆ‡åˆ†ï¼ˆ1.5hï¼‰**

1. åœ¨utils/ç›®å½•ä¸‹åˆ›å»º[rag_utils.py](http://rag_utils.py/)ï¼Œç¼–å†™æ–‡æœ¬å¤„ç†å‡½æ•°ï¼š

```python
from langchain_community.document_loaders import PyPDFLoader
from langchain_text_splitters import RecursiveCharacterTextSplitter


def load_and_split_doc():
    # åŠ è½½PDF
    loader = PyPDFLoader("data/æ ¡å›­æŠ¥åˆ°æ‰‹å†Œ.pdf")
    documents = loader.load()
    # è¯­ä¹‰åˆ‡åˆ†ï¼ˆchunk_size=500ï¼Œchunk_overlap=50ï¼Œå¯è°ƒæ•´ï¼‰
    text_splitter = RecursiveCharacterTextSplitter(
        chunk_size=500,
        chunk_overlap=50,
        length_function=len,
        separators=["\n\n", "\n", ". ", " ", ""]
    )
    splits = text_splitter.split_documents(documents)
    print(f"åˆ‡åˆ†åæ–‡æœ¬å—æ•°é‡ï¼š{len(splits)}")
    return splits


if __name__ == "__main__":
    load_and_split_doc()
```

1. è¿è¡Œè„šæœ¬ï¼špython utils/[rag_utils.py](http://rag_utils.py/)ï¼ŒæŸ¥çœ‹åˆ‡åˆ†åçš„æ–‡æœ¬å—æ•°é‡ï¼Œæ‰‹åŠ¨æ£€æŸ¥å‰ 3 ä¸ªæ–‡æœ¬å—ï¼Œç¡®ä¿è¯­ä¹‰å®Œæ•´ã€‚

**æ­¥éª¤ 3ï¼šå‘é‡åŒ–ä¸ Chroma å­˜å‚¨ï¼ˆ1.5hï¼‰**

1. åœ¨[rag_utils.py](http://rag_utils.py/)ä¸­æ·»åŠ å‘é‡åŒ–ä¸å­˜å‚¨å‡½æ•°ï¼š

```python
from langchain_community.embeddings import SentenceTransformerEmbeddings
from langchain_community.vectorstores import Chroma


def init_chroma_db(splits):
    # åˆå§‹åŒ–å¼€æºEmbeddingæ¨¡å‹ï¼ˆBGE-m3ï¼‰
    embedding = SentenceTransformerEmbeddings(model_name="BAAI/bge-m3")
    # åˆ›å»ºChromaå‘é‡åº“ï¼ˆæœ¬åœ°å­˜å‚¨ï¼Œè·¯å¾„ï¼šdb/chroma_dbï¼‰
    db = Chroma.from_documents(
        documents=splits,
        embedding=embedding,
        persist_directory="db/chroma_db"
    )
    db.persist()
    print("Chromaå‘é‡åº“åˆå§‹åŒ–å®Œæˆï¼")
    return db


if __name__ == "__main__":
    splits = load_and_split_doc()
    init_chroma_db(splits)
```

1. è¿è¡Œè„šæœ¬ï¼Œç­‰å¾…æ¨¡å‹ä¸‹è½½ä¸å‘é‡åº“æ„å»ºï¼ˆé¦–æ¬¡è¿è¡Œè¾ƒæ…¢ï¼Œè€å¿ƒç­‰å¾…ï¼‰ï¼›
2. æ£€æŸ¥db/chroma_dbç›®å½•ï¼Œç¡®è®¤ç”Ÿæˆå‘é‡åº“æ–‡ä»¶ï¼ˆchroma.sqlite3 ç­‰ï¼‰ã€‚

**æ­¥éª¤ 4ï¼šåŸºç¡€æ£€ç´¢å®ç°ï¼ˆ1.5hï¼‰**

1. åœ¨[rag_utils.py](http://rag_utils.py/)ä¸­æ·»åŠ æ£€ç´¢å‡½æ•°ï¼š

```python
def retrieve_from_chroma(query, k=3):
    # åŠ è½½å·²æ„å»ºçš„Chromaå‘é‡åº“
    embedding = SentenceTransformerEmbeddings(model_name="BAAI/bge-m3")
    db = Chroma(
        persist_directory="db/chroma_db",
        embedding_function=embedding
    )
    # 1. è¯­ä¹‰æ£€ç´¢ï¼ˆç›¸ä¼¼åº¦åŒ¹é…ï¼‰
    semantic_results = db.similarity_search(query, k=k)
    print("\n=== è¯­ä¹‰æ£€ç´¢ç»“æœ ===")
    for i, doc in enumerate(semantic_results):
        print(f"{i+1}. å†…å®¹ï¼š{doc.page_content[:100]}...")
        print(f"   æ¥æºï¼š{doc.metadata}")
    # 2. æ··åˆæ£€ç´¢ï¼ˆå…³é”®è¯+è¯­ä¹‰ï¼ŒåŸºäºmmré‡æ’åºï¼‰
    hybrid_results = db.max_marginal_relevance_search(query, k=k, fetch_k=10)
    print("\n=== æ··åˆæ£€ç´¢ç»“æœ ===")
    for i, doc in enumerate(hybrid_results):
        print(f"{i+1}. å†…å®¹ï¼š{doc.page_content[:100]}...")
        print(f"   æ¥æºï¼š{doc.metadata}")
    return semantic_results, hybrid_results


if __name__ == "__main__":
    splits = load_and_split_doc()
    db = init_chroma_db(splits)
    # æµ‹è¯•æŸ¥è¯¢ï¼ˆä¾‹å¦‚ï¼š"æŠ¥åˆ°éœ€è¦å¸¦ä»€ä¹ˆææ–™ï¼Ÿ"ï¼‰
    retrieve_from_chroma("æŠ¥åˆ°éœ€è¦å¸¦ä»€ä¹ˆææ–™ï¼Ÿ")
```

1. è¿è¡Œè„šæœ¬ï¼Œè¾“å…¥ 3 ä¸ªä¸åŒçš„æµ‹è¯•æŸ¥è¯¢ï¼ˆå¦‚æŠ¥åˆ°ææ–™ã€ç¼´è´¹æ ‡å‡†ã€å®¿èˆåˆ†é…ï¼‰ï¼Œå¯¹æ¯”è¯­ä¹‰æ£€ç´¢ä¸æ··åˆæ£€ç´¢çš„ç»“æœå·®å¼‚ï¼›
2. è°ƒæ•´chunk_size/chunk_overlapå‚æ•°ï¼Œé‡æ–°è¿è¡Œå¹¶è§‚å¯Ÿæ£€ç´¢ç»“æœå˜åŒ–ï¼ˆä¼˜åŒ–å‡†ç¡®ç‡ï¼‰ã€‚

**æ­¥éª¤ 5ï¼šä»£ç æäº¤ä¸ PRï¼ˆ0.5hï¼‰**

1. æäº¤ä»£ç ï¼šgit add . â†’ git commit -m "feat: å®ŒæˆRAGå‘é‡åº“æ„å»ºä¸æ£€ç´¢åŠŸèƒ½"ï¼›
2. æ¨é€åˆ†æ”¯ï¼šgit push origin feature/day2ï¼›
3. åˆ›å»º PRï¼ˆbase: devï¼Œcompare: feature/day2ï¼‰ï¼Œé™„æ£€ç´¢ç»“æœæˆªå›¾ã€‚

**å…­ã€è€ƒæ ¸æ–¹æ³•ï¼ˆé‡åŒ–è¯„åˆ†ï¼Œ10 åˆ†ï¼‰**

| è€ƒæ ¸é¡¹ | åˆ†å€¼ | è¯„åˆ†æ ‡å‡† |
| --- | --- | --- |
| æ–‡æœ¬åˆ‡åˆ† | 2 åˆ† | åˆ‡åˆ†å‚æ•°åˆç†ï¼Œæ–‡æœ¬å—è¯­ä¹‰å®Œæ•´ï¼Œæ— æ–­è£‚ |
| å‘é‡åº“æ„å»º | 3 åˆ† | æˆåŠŸç”Ÿæˆ Chroma å‘é‡åº“ï¼Œæ— æŠ¥é”™ï¼Œæ–‡ä»¶å®Œæ•´ |
| æ£€ç´¢åŠŸèƒ½ | 4 åˆ† | å®ç°è¯­ä¹‰ + æ··åˆæ£€ç´¢ï¼Œæµ‹è¯• 3 ä¸ªæŸ¥è¯¢å‡èƒ½è¿”å›ç›¸å…³ç»“æœ |
| åŠ åˆ†é¡¹ | 1 åˆ† | ä¼˜åŒ–åˆ‡åˆ†å‚æ•°æå‡æ£€ç´¢å‡†ç¡®ç‡ï¼Œæäº¤å‚æ•°å¯¹æ¯”åˆ†æ |

---

## Day 3ï¼šå¤æ‚å…³ç³»å¤„ç†ï¼ˆçŸ¥è¯†å›¾è°± Neo4jï¼‰

**ä¸€ã€å‰æœŸçŸ¥è¯†ï¼ˆè¯¾å‰é¢„ä¹ ï¼Œ1hï¼‰**

1. å›¾æ•°æ®åº“æ ¸å¿ƒæ¦‚å¿µï¼ˆèŠ‚ç‚¹ã€è¾¹ã€å±æ€§ï¼‰ï¼›
2. Cypher æŸ¥è¯¢è¯­å¥åŸºç¡€ï¼ˆåˆ›å»ºèŠ‚ç‚¹ã€åˆ›å»ºå…³ç³»ã€æŸ¥è¯¢ï¼‰ï¼›
3. çŸ¥è¯†å›¾è°±å»ºæ¨¡åŸåˆ™ï¼ˆå®ä½“æŠ½è±¡ã€å…³ç³»å®šä¹‰ï¼‰ã€‚

**äºŒã€å®éªŒç›®æ ‡**

1. æŒæ¡æ™ºæ…§æ ¡å›­åœºæ™¯çš„å›¾å»ºæ¨¡æ–¹æ³•ï¼›
2. å®Œæˆ Neo4j çŸ¥è¯†å›¾è°±æ­å»ºï¼ˆæ•°æ®å¯¼å…¥ + å¯è§†åŒ–ï¼‰ï¼›
3. å®ç°å¤šè·³æŸ¥è¯¢ä¸ Text-to-Cypher åŠŸèƒ½ã€‚

**ä¸‰ã€éš¾ç‚¹é‡ç‚¹**

- **é‡ç‚¹**ï¼šå›¾æ¨¡å‹è®¾è®¡ã€Cypher è„šæœ¬ç¼–å†™ã€å¤šè·³æŸ¥è¯¢å®ç°ï¼›
- **éš¾ç‚¹**ï¼šText-to-Cypher è¯­å¥å‡†ç¡®æ€§ã€é¿å…æŸ¥è¯¢æ­»å¾ªç¯ã€‚

**å››ã€çŸ¥è¯†åŸºç¡€**

- å¿…å¤‡ï¼šSQL æŸ¥è¯¢é€»è¾‘ã€JSON æ•°æ®å¤„ç†ï¼›
- å¯é€‰ï¼šå›¾è®ºåŸºç¡€ï¼ˆæ— éœ€æ·±å…¥ï¼Œäº†è§£ â€œå…³ç³»â€ æ¦‚å¿µå³å¯ï¼‰ã€‚

**äº”ã€å®éªŒæ­¥éª¤ï¼ˆ8hï¼Œå« 2h ç†è®ºè®²è§£ï¼‰**

**é˜¶æ®µ 1ï¼šç†è®ºè®²è§£ï¼ˆ2hï¼‰**

1. å›¾æ•°æ®åº“ä¸å…³ç³»å‹æ•°æ®åº“çš„åŒºåˆ«ï¼ˆé€‚åˆå¤æ‚å…³ç³»æŸ¥è¯¢ï¼‰ï¼ˆ20minï¼‰ï¼›
2. æ™ºæ…§æ ¡å›­å›¾å»ºæ¨¡ï¼šæ ¸å¿ƒå®ä½“ï¼ˆå­¦ç”Ÿã€æ•™å¸ˆã€å®éªŒå®¤ã€è¯¾ç¨‹ã€é™¢ç³»ï¼‰ã€å…³ç³»ï¼ˆéš¶å±ã€æˆè¯¾ã€é€‰ä¿®ã€å…¥é©»ï¼‰ï¼ˆ30minï¼‰ï¼›
3. Cypher è¯­å¥è¯¦è§£ï¼šåˆ›å»ºèŠ‚ç‚¹ï¼ˆCREATEï¼‰ã€åˆ›å»ºå…³ç³»ï¼ˆMATCH+CREATEï¼‰ã€æŸ¥è¯¢ï¼ˆMATCH+RETURNï¼‰ã€å¤šè·³æŸ¥è¯¢ï¼ˆMATCH ...-[]->...-[]->...ï¼‰ï¼ˆ30minï¼‰ï¼›
4. Neo4j Aura äº‘å®ä¾‹æ­å»ºä¸ LangChain é›†æˆï¼ˆ20minï¼‰ï¼›
5. Text-to-Cypher åŸç†ä¸é”™è¯¯å¤„ç†ï¼ˆ20minï¼‰ã€‚

**é˜¶æ®µ 2ï¼šå®æ“è½åœ°ï¼ˆ6hï¼‰**

**æ­¥éª¤ 1ï¼šNeo4j ç¯å¢ƒæ­å»ºï¼ˆ1hï¼‰**

1. æ³¨å†Œ / ç™»å½• Neo4j è´¦å·ï¼Œåˆ›å»º Aura å…è´¹å®ä¾‹ï¼ˆhttps://neo4j.com/aura/ï¼‰ï¼›
2. è®°å½•å®ä¾‹è¿æ¥ä¿¡æ¯ï¼ˆURIã€ç”¨æˆ·åã€å¯†ç ï¼‰ï¼Œæ”¾å…¥.envæ–‡ä»¶ï¼š

```
NEO4J_URI="neo4j+s://xxx.databases.neo4j.io:7687"
NEO4J_USER="neo4j"
NEO4J_PASSWORD="xxx"
```

1. å®‰è£… Neo4j ä¾èµ–ï¼špip install neo4j langchain-openaiï¼ˆOpenAI ç”¨äº Text-to-Cypherï¼Œå¯æ›¿æ¢ä¸ºå¼€æºæ¨¡å‹ï¼‰ã€‚

**æ­¥éª¤ 2ï¼šå›¾å»ºæ¨¡ä¸æ•°æ®å¯¼å…¥ï¼ˆ2hï¼‰**

1. åœ¨db/ç›®å½•ä¸‹åˆ›å»º[neo4j_utils.py](http://neo4j_utils.py/)ï¼Œç¼–å†™ Cypher å¯¼å…¥è„šæœ¬ï¼š

```python
from neo4j import GraphDatabase
import os
from dotenv import load_dotenv

load_dotenv()


class Neo4jGraph:
    def __init__(self):
        self.driver = GraphDatabase.driver(
            os.getenv("NEO4J_URI"),
            auth=(os.getenv("NEO4J_USER"), os.getenv("NEO4J_PASSWORD"))
        )

    def close(self):
        self.driver.close()

    def init_graph(self):
        # 1. åˆ›å»ºçº¦æŸï¼ˆé¿å…é‡å¤èŠ‚ç‚¹ï¼‰
        constraints = [
            "CREATE CONSTRAINT IF NOT EXISTS FOR (s:Student) REQUIRE s.id IS UNIQUE",
            "CREATE CONSTRAINT IF NOT EXISTS FOR (t:Teacher) REQUIRE t.id IS UNIQUE",
            "CREATE CONSTRAINT IF NOT EXISTS FOR (d:Department) REQUIRE d.name IS UNIQUE",
            "CREATE CONSTRAINT IF NOT EXISTS FOR (l:Laboratory) REQUIRE l.name IS UNIQUE",
            "CREATE CONSTRAINT IF NOT EXISTS FOR (c:Course) REQUIRE c.id IS UNIQUE"
        ]
        with self.driver.session() as session:
            for constraint in constraints:
                session.run(constraint)
            print("çº¦æŸåˆ›å»ºå®Œæˆï¼")
            # 2. å¯¼å…¥ä»¿çœŸæ•°æ®ï¼ˆèŠ‚ç‚¹+å…³ç³»ï¼‰
            cypher_script = """
            // åˆ›å»ºé™¢ç³»èŠ‚ç‚¹
            CREATE (d1:Department {name: 'è®¡ç®—æœºå­¦é™¢', code: 'CS'}),
                   (d2:Department {name: 'ç”µå­ä¿¡æ¯å­¦é™¢', code: 'EE'});
            // åˆ›å»ºæ•™å¸ˆèŠ‚ç‚¹
            CREATE (t1:Teacher {id: 'T001', name: 'å¼ ä¸‰', title: 'æ•™æˆ'}),
                   (t2:Teacher {id: 'T002', name: 'æå››', title: 'å‰¯æ•™æˆ'});
            // åˆ›å»ºå®éªŒå®¤èŠ‚ç‚¹
            CREATE (l1:Laboratory {name: 'äººå·¥æ™ºèƒ½å®éªŒå®¤', location: 'ç§‘ç ”æ¥¼A301'}),
                   (l2:Laboratory {name: 'åµŒå…¥å¼å®éªŒå®¤', location: 'ç§‘ç ”æ¥¼B202'});
            // åˆ›å»ºè¯¾ç¨‹èŠ‚ç‚¹
            CREATE (c1:Course {id: 'C001', name: 'å¤§æ¨¡å‹åº”ç”¨å¼€å‘', credit: 3}),
                   (c2:Course {id: 'C002', name: 'å›¾æ•°æ®åº“åŸç†', credit: 2});
            // åˆ›å»ºå­¦ç”ŸèŠ‚ç‚¹
            CREATE (s1:Student {id: 'S001', name: 'ç‹äº”', grade: 'å¤§ä¸‰'}),
                   (s2:Student {id: 'S002', name: 'èµµå…­', grade: 'å¤§å››'});
            // åˆ›å»ºå…³ç³»ï¼šé™¢ç³»-æ•™å¸ˆï¼ˆéš¶å±ï¼‰
            MATCH (d:Department {name: 'è®¡ç®—æœºå­¦é™¢'}), (t:Teacher) WHERE t.id IN ['T001', 'T002']
            CREATE (t)-[:BELONGS_TO]->(d);
            // åˆ›å»ºå…³ç³»ï¼šæ•™å¸ˆ-å®éªŒå®¤ï¼ˆå…¥é©»ï¼‰
            MATCH (t:Teacher {id: 'T001'}), (l:Laboratory {name: 'äººå·¥æ™ºèƒ½å®éªŒå®¤'})
            CREATE (t)-[:WORKS_IN]->(l);
            MATCH (t:Teacher {id: 'T002'}), (l:Laboratory {name: 'åµŒå…¥å¼å®éªŒå®¤'})
            CREATE (t)-[:WORKS_IN]->(l);
            // åˆ›å»ºå…³ç³»ï¼šæ•™å¸ˆ-è¯¾ç¨‹ï¼ˆæˆè¯¾ï¼‰
            MATCH (t:Teacher {id: 'T001'}), (c:Course {id: 'C001'})
            CREATE (t)-[:TEACHES]->(c);
            MATCH (t:Teacher {id: 'T002'}), (c:Course {id: 'C002'})
            CREATE (t)-[:TEACHES]->(c);
            // åˆ›å»ºå…³ç³»ï¼šå­¦ç”Ÿ-è¯¾ç¨‹ï¼ˆé€‰ä¿®ï¼‰
            MATCH (s:Student {id: 'S001'}), (c:Course) WHERE c.id IN ['C001', 'C002']
            CREATE (s)-[:TAKES]->(c);
            MATCH (s:Student {id: 'S002'}), (c:Course {id: 'C001'})
            CREATE (s)-[:TAKES]->(c);
            // åˆ›å»ºå…³ç³»ï¼šå­¦ç”Ÿ-é™¢ç³»ï¼ˆéš¶å±ï¼‰
            MATCH (s:Student), (d:Department {name: 'è®¡ç®—æœºå­¦é™¢'})
            CREATE (s)-[:BELONGS_TO]->(d);
            """
            session.run(cypher_script)
            print("çŸ¥è¯†å›¾è°±æ•°æ®å¯¼å…¥å®Œæˆï¼")


if __name__ == "__main__":
    graph = Neo4jGraph()
    graph.init_graph()
    graph.close()
```

1. è¿è¡Œè„šæœ¬ï¼špython db/[neo4j_utils.py](http://neo4j_utils.py/)ï¼Œæ— æŠ¥é”™åˆ™å¯¼å…¥æˆåŠŸï¼›
2. ç™»å½• Neo4j Aura æ§åˆ¶å°ï¼ŒæŸ¥çœ‹å¯è§†åŒ–å›¾è°±ï¼ˆå·¦ä¾§ â€œGraphâ€ æ ‡ç­¾ï¼‰ï¼Œç¡®è®¤èŠ‚ç‚¹ã€è¾¹åˆ›å»ºæ­£ç¡®ã€‚

**æ­¥éª¤ 3ï¼šå¤šè·³æŸ¥è¯¢å®ç°ï¼ˆ1.5hï¼‰**

1. åœ¨[neo4j_utils.py](http://neo4j_utils.py/)ä¸­æ·»åŠ æŸ¥è¯¢å‡½æ•°ï¼š

```python
def multi_hop_query(self, query_type):
    """å®ç°å¤šè·³æŸ¥è¯¢"""
    with self.driver.session() as session:
        if query_type == 1:
            # æŸ¥è¯¢ï¼šè®¡ç®—æœºå­¦é™¢å¼ è€å¸ˆçš„å®éªŒå®¤é‡Œçš„å­¦ç”Ÿï¼ˆ3è·³ï¼šå­¦ç”Ÿ-è¯¾ç¨‹-æ•™å¸ˆ-å®éªŒå®¤ï¼‰
            cypher = """
            MATCH (s:Student)-[:TAKES]->(c:Course)-[:TEACHES]->(t:Teacher)-[:WORKS_IN]->(l:Laboratory)
            WHERE t.name = 'å¼ ä¸‰' AND s-[:BELONGS_TO]->(:Department {name: 'è®¡ç®—æœºå­¦é™¢'})
            RETURN s.name AS å­¦ç”Ÿå§“å, l.name AS å®éªŒå®¤åç§°
            """
        elif query_type == 2:
            # æŸ¥è¯¢ï¼šé€‰ä¿®å¤§æ¨¡å‹è¯¾ç¨‹çš„å­¦ç”Ÿæ‰€å±é™¢ç³»ï¼ˆ2è·³ï¼šå­¦ç”Ÿ-è¯¾ç¨‹ï¼Œå­¦ç”Ÿ-é™¢ç³»ï¼‰
            cypher = """
            MATCH (s:Student)-[:TAKES]->(c:Course {name: 'å¤§æ¨¡å‹åº”ç”¨å¼€å‘'}), (s)-[:BELONGS_TO]->(d:Department)
            RETURN s.name AS å­¦ç”Ÿå§“å, d.name AS é™¢ç³»åç§°
            """
        elif query_type == 3:
            # æŸ¥è¯¢ï¼šäººå·¥æ™ºèƒ½å®éªŒå®¤çš„æ•™å¸ˆæˆè¯¾çš„è¯¾ç¨‹ï¼ˆ2è·³ï¼šå®éªŒå®¤-æ•™å¸ˆ-è¯¾ç¨‹ï¼‰
            cypher = """
            MATCH (l:Laboratory {name: 'äººå·¥æ™ºèƒ½å®éªŒå®¤'})<-[:WORKS_IN]-(t:Teacher)-[:TEACHES]->(c:Course)
            RETURN t.name AS æ•™å¸ˆå§“å, c.name AS è¯¾ç¨‹åç§°
            """
        else:
            return "æ— æ•ˆæŸ¥è¯¢ç±»å‹"
        result = session.run(cypher)
        return [dict(record) for record in result]


# æµ‹è¯•å¤šè·³æŸ¥è¯¢
if __name__ == "__main__":
    graph = Neo4jGraph()
    # æµ‹è¯•3ç§å¤šè·³æŸ¥è¯¢
    print("=== å¤šè·³æŸ¥è¯¢1ç»“æœ ===")
    print(graph.multi_hop_query(1))
    print("\n=== å¤šè·³æŸ¥è¯¢2ç»“æœ ===")
    print(graph.multi_hop_query(2))
    print("\n=== å¤šè·³æŸ¥è¯¢3ç»“æœ ===")
    print(graph.multi_hop_query(3))
    graph.close()
```

1. è¿è¡Œè„šæœ¬ï¼ŒæŸ¥çœ‹ 3 ç§å¤šè·³æŸ¥è¯¢ç»“æœï¼Œç¡®ä¿è¿”å›æ­£ç¡®ï¼›
2. è‡ªå®šä¹‰ 1 ä¸ªå¤šè·³æŸ¥è¯¢ï¼ˆå¦‚ â€œæŸ¥è¯¢åµŒå…¥å¼å®éªŒå®¤æ•™å¸ˆçš„å­¦ç”Ÿâ€ï¼‰ï¼Œæ·»åŠ åˆ°å‡½æ•°ä¸­å¹¶æµ‹è¯•ã€‚

**æ­¥éª¤ 4ï¼šText-to-Cypher å®ç°ï¼ˆ1hï¼‰**

1. åœ¨[neo4j_utils.py](http://neo4j_utils.py/)ä¸­æ·»åŠ  Text-to-Cypher å‡½æ•°ï¼ˆä½¿ç”¨ LangChainï¼‰ï¼š

```python
from langchain.chains import GraphCypherQAChain
from langchain_openai import ChatOpenAI


def text_to_cypher(self, natural_query):
    """è‡ªç„¶è¯­è¨€è½¬CypheræŸ¥è¯¢"""
    llm = ChatOpenAI(model_name="gpt-3.5-turbo", temperature=0)  # å¯æ›¿æ¢ä¸ºå¼€æºæ¨¡å‹
    chain = GraphCypherQAChain.from_llm(
        llm,
        graph=self.driver,
        verbose=True,
        return_intermediate_steps=True  # è¾“å‡ºCypherè¯­å¥ï¼Œä¾¿äºè°ƒè¯•
    )
    try:
        result = chain({"query": natural_query})
        print(f"ç”Ÿæˆçš„Cypherè¯­å¥ï¼š{result['intermediate_steps'][0]['query']}")
        print(f"æŸ¥è¯¢ç»“æœï¼š{result['result']}")
        return result
    except Exception as e:
        print(f"Text-to-Cypherå¤±è´¥ï¼š{e}")
        return {"error": str(e)}


# æµ‹è¯•Text-to-Cypher
if __name__ == "__main__":
    graph = Neo4jGraph()
    # æµ‹è¯•è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼š"å¼ ä¸‰è€å¸ˆæ•™å“ªäº›è¯¾ç¨‹ï¼Ÿ"
    graph.text_to_cypher("å¼ ä¸‰è€å¸ˆæ•™å“ªäº›è¯¾ç¨‹ï¼Ÿ")
    graph.close()
```

1. é…ç½® OpenAI API å¯†é’¥ï¼ˆæ”¾å…¥.envï¼šOPENAI_API_KEY="xxx"ï¼‰ï¼Œè¿è¡Œè„šæœ¬ï¼›
2. æŸ¥çœ‹ç”Ÿæˆçš„ Cypher è¯­å¥æ˜¯å¦æ­£ç¡®ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸï¼›
3. æµ‹è¯• 2 ä¸ªä¸åŒçš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œæ·»åŠ é”™è¯¯å¤„ç†ï¼ˆå¦‚æ— æ•ˆæŸ¥è¯¢çš„å…œåº•å›å¤ï¼‰ã€‚

**æ­¥éª¤ 5ï¼šä»£ç æäº¤ä¸ PRï¼ˆ0.5hï¼‰**

1. æäº¤ä»£ç ï¼šgit add . â†’ git commit -m "feat: å®ŒæˆNeo4jçŸ¥è¯†å›¾è°±æ­å»ºä¸å¤šè·³æŸ¥è¯¢/Text-to-Cypher"ï¼›
2. æ¨é€åˆ†æ”¯ï¼šgit push origin feature/day3ï¼›
3. åˆ›å»º PRï¼Œé™„ Neo4j å¯è§†åŒ–æˆªå›¾å’ŒæŸ¥è¯¢ç»“æœæˆªå›¾ã€‚

**å…­ã€è€ƒæ ¸æ–¹æ³•ï¼ˆé‡åŒ–è¯„åˆ†ï¼Œ10 åˆ†ï¼‰**

| è€ƒæ ¸é¡¹ | åˆ†å€¼ | è¯„åˆ†æ ‡å‡† |
| --- | --- | --- |
| å›¾æ¨¡å‹ä¸æ•°æ®å¯¼å…¥ | 3 åˆ† | èŠ‚ç‚¹ / è¾¹åˆ›å»ºæ­£ç¡®ï¼Œçº¦æŸåˆç†ï¼Œæ— é‡å¤æ•°æ® |
| å¤šè·³æŸ¥è¯¢ | 3 åˆ† | å®ç° 3 ç§åŸºç¡€å¤šè·³æŸ¥è¯¢ï¼Œç»“æœå‡†ç¡®ï¼›è‡ªå®šä¹‰ 1 ä¸ªæŸ¥è¯¢å¹¶æˆåŠŸè¿è¡Œ |
| Text-to-Cypher | 3 åˆ† | è‡ªç„¶è¯­è¨€è½¬ Cypher è¯­å¥å‡†ç¡®ï¼Œ2 ä¸ªæµ‹è¯•æŸ¥è¯¢ç»“æœæ­£ç¡® |
| åŠ åˆ†é¡¹ | 1 åˆ† | æ·»åŠ  Text-to-Cypher é”™è¯¯å¤„ç†ï¼Œé¿å…æ­»å¾ªç¯ / æ— æ•ˆè¯­å¥ |

---

## Day 4ï¼šä¸šåŠ¡æ•°æ®åº“è®¾è®¡ï¼ˆSupabaseï¼‰

**ä¸€ã€å‰æœŸçŸ¥è¯†ï¼ˆè¯¾å‰é¢„ä¹ ï¼Œ1hï¼‰**

1. å…³ç³»å‹æ•°æ®åº“è®¾è®¡åŸåˆ™ï¼ˆä¸‰å¤§èŒƒå¼ï¼‰ï¼›
2. SQL è¡¨è®¾è®¡ï¼ˆå­—æ®µç±»å‹ã€ä¸»é”®ã€å¤–é”®ã€ç´¢å¼•ï¼‰ï¼›
3. FastAPI æ¥å£å¼€å‘åŸºç¡€ï¼ˆè·¯å¾„æ“ä½œã€è¯·æ±‚ / å“åº”æ¨¡å‹ï¼‰ã€‚

**äºŒã€å®éªŒç›®æ ‡**

1. æŒæ¡æ™ºæ…§æ ¡å›­æ ¸å¿ƒä¸šåŠ¡è¡¨çš„è®¾è®¡æ–¹æ³•ï¼›
2. å®Œæˆ Supabase ä¸šåŠ¡è¡¨åˆ›å»ºä¸æ•°æ®å¯¼å…¥ï¼›
3. å®ç°åŸºäº FastAPI çš„ä¸šåŠ¡æ¥å£å¼€å‘ä¸æµ‹è¯•ã€‚

**ä¸‰ã€éš¾ç‚¹é‡ç‚¹**

- **é‡ç‚¹**ï¼šä¸šåŠ¡è¡¨è®¾è®¡ï¼ˆç¬¦åˆä¸‰å¤§èŒƒå¼ï¼‰ã€FastAPI åˆ†å±‚å¼€å‘ï¼ˆDAO/Service/APIï¼‰ï¼›
- **éš¾ç‚¹**ï¼šè¡¨ä¹‹é—´çš„å…³è”å…³ç³»è®¾è®¡ã€æ¥å£çš„å¹‚ç­‰æ€§ä¸é”™è¯¯å¤„ç†ã€‚

**å››ã€çŸ¥è¯†åŸºç¡€**

- å¿…å¤‡ï¼šSQL åˆ›å»ºè¡¨ï¼ˆCREATE TABLEï¼‰ã€æ’å…¥ï¼ˆINSERTï¼‰ã€æŸ¥è¯¢ï¼ˆSELECTï¼‰è¯­å¥ï¼›
- å¯é€‰ï¼šPython ç±»ä¸å‡½æ•°ã€JSON æ•°æ®æ ¼å¼ã€‚

**äº”ã€å®éªŒæ­¥éª¤ï¼ˆ8hï¼Œå« 2h ç†è®ºè®²è§£ï¼‰**

**é˜¶æ®µ 1ï¼šç†è®ºè®²è§£ï¼ˆ2hï¼‰**

1. å…³ç³»å‹æ•°æ®åº“è®¾è®¡ä¸‰å¤§èŒƒå¼ï¼ˆé¿å…å†—ä½™ã€ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼‰ï¼ˆ30minï¼‰ï¼›
2. æ™ºæ…§æ ¡å›­æ ¸å¿ƒä¸šåŠ¡è¡¨åˆ†æï¼šå­¦ç±ï¼ˆstudent_recordsï¼‰ã€è´¢åŠ¡ï¼ˆpaymentsï¼‰ã€å®¿èˆï¼ˆdormitoryï¼‰ï¼ˆ30minï¼‰ï¼›
3. Supabase è¡¨è®¾è®¡ä¸ RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰ç­–ç•¥ä»‹ç»ï¼ˆ20minï¼‰ï¼›
4. FastAPI åˆ†å±‚å¼€å‘ï¼šDAOï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰ã€Serviceï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰ã€APIï¼ˆæ¥å£å±‚ï¼‰ï¼ˆ30minï¼‰ï¼›
5. æ¥å£æµ‹è¯•å·¥å…·ï¼ˆSwagger UIã€Postmanï¼‰ä½¿ç”¨æ–¹æ³•ï¼ˆ10minï¼‰ã€‚

**é˜¶æ®µ 2ï¼šå®æ“è½åœ°ï¼ˆ6hï¼‰**

**æ­¥éª¤ 1ï¼šä¸šåŠ¡è¡¨è®¾è®¡ä¸åˆ›å»ºï¼ˆ1.5hï¼‰**

1. åœ¨db/ç›®å½•ä¸‹åˆ›å»º[models.py](http://models.py/)ï¼Œå®šä¹‰ä¸šåŠ¡è¡¨ SQLï¼š

```python
import psycopg2
from dotenv import load_dotenv
import os

load_dotenv()


def create_business_tables():
    """åˆ›å»ºæ ¸å¿ƒä¸šåŠ¡è¡¨ï¼šstudent_recordsï¼ˆå­¦ç±ï¼‰ã€paymentsï¼ˆè´¢åŠ¡ï¼‰ã€dormitoryï¼ˆå®¿èˆï¼‰"""
    conn = None
    try:
        conn = psycopg2.connect(os.getenv("SUPABASE_DB_URL"))
        cur = conn.cursor()
        # 1. å­¦ç±è¡¨ï¼ˆstudent_recordsï¼‰
        cur.execute("""
        CREATE TABLE IF NOT EXISTS student_records (
            student_id VARCHAR(20) PRIMARY KEY,
            name VARCHAR(50) NOT NULL,
            gender VARCHAR(10),
            grade VARCHAR(10) NOT NULL,
            department VARCHAR(50) NOT NULL,
            admission_date DATE NOT NULL,
            status VARCHAR(20) DEFAULT 'active',
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );
        """)
        # 2. è´¢åŠ¡è¡¨ï¼ˆpaymentsï¼‰
        cur.execute("""
        CREATE TABLE IF NOT EXISTS payments (
            payment_id SERIAL PRIMARY KEY,
            student_id VARCHAR(20) NOT NULL,
            amount DECIMAL(10, 2) NOT NULL,
            payment_type VARCHAR(30) NOT NULL,  -- å­¦è´¹/ä½å®¿è´¹/å…¶ä»–
            status VARCHAR(20) DEFAULT 'unpaid',  -- unpaid/paid
            payment_date DATE,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (student_id) REFERENCES student_records(student_id) ON DELETE CASCADE
        );
        """)
        # 3. å®¿èˆè¡¨ï¼ˆdormitoryï¼‰
        cur.execute("""
        CREATE TABLE IF NOT EXISTS dormitory (
            dorm_id VARCHAR(20) PRIMARY KEY,
            student_id VARCHAR(20) UNIQUE NOT NULL,
            building VARCHAR(20) NOT NULL,
            floor INT NOT NULL,
            room_number VARCHAR(10) NOT NULL,
            bed_number INT NOT NULL,
            check_in_date DATE NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (student_id) REFERENCES student_records(student_id) ON DELETE CASCADE
        );
        """)
        # æ·»åŠ ç´¢å¼•ï¼ˆä¼˜åŒ–æŸ¥è¯¢ï¼‰
        cur.execute("CREATE INDEX IF NOT EXISTS idx_payments_student_id ON payments(student_id);")
        cur.execute("CREATE INDEX IF NOT EXISTS idx_dormitory_student_id ON dormitory(student_id);")
        conn.commit()
        print("ä¸šåŠ¡è¡¨åˆ›å»ºå®Œæˆï¼")
        cur.close()
    except Exception as e:
        print(f"åˆ›å»ºä¸šåŠ¡è¡¨å¤±è´¥ï¼š{e}")
        if conn:
            conn.rollback()
    finally:
        if conn:
            conn.close()


if __name__ == "__main__":
    create_business_tables()
```

1. è¿è¡Œè„šæœ¬ï¼špython db/[models.py](http://models.py/)ï¼Œæ— æŠ¥é”™åˆ™è¡¨åˆ›å»ºæˆåŠŸï¼›
2. ç™»å½• Supabase Dashboard â†’ Table Editorï¼ŒéªŒè¯è¡¨ç»“æ„æ˜¯å¦æ­£ç¡®ã€‚

**æ­¥éª¤ 2ï¼šä»¿çœŸæ•°æ®å¯¼å…¥ï¼ˆ1hï¼‰**

1. åœ¨db/ç›®å½•ä¸‹åˆ›å»º[seed_data.py](http://seed_data.py/)ï¼Œç¼–å†™æ•°æ®å¯¼å…¥è„šæœ¬ï¼š

```python
import psycopg2
from dotenv import load_dotenv
import os
from datetime import date

load_dotenv()


def seed_business_data():
    """å¯¼å…¥ä¸šåŠ¡è¡¨ä»¿çœŸæ•°æ®"""
    conn = None
    try:
        conn = psycopg2.connect(os.getenv("SUPABASE_DB_URL"))
        cur = conn.cursor()
        # å¯¼å…¥å­¦ç±æ•°æ®
        student_data = [
            ("S001", "ç‹äº”", "ç”·", "å¤§ä¸‰", "è®¡ç®—æœºå­¦é™¢", date(2022, 9, 1), "active"),
            ("S002", "èµµå…­", "å¥³", "å¤§å››", "è®¡ç®—æœºå­¦é™¢", date(2021, 9, 1), "active"),
            ("S003", "å­™ä¸ƒ", "ç”·", "å¤§ä¸‰", "ç”µå­ä¿¡æ¯å­¦é™¢", date(2022, 9, 1), "active"),
            ("S004", "å‘¨å…«", "å¥³", "å¤§äºŒ", "è®¡ç®—æœºå­¦é™¢", date(2023, 9, 1), "active")
        ]
        cur.executemany("""
        INSERT INTO student_records (student_id, name, gender, grade, department, admission_date, status)
        VALUES (%s, %s, %s, %s, %s, %s, %s)
        ON CONFLICT (student_id) DO NOTHING;
        """, student_data)
        # å¯¼å…¥è´¢åŠ¡æ•°æ®
        payment_data = [
            ("S001", 8000.00, "å­¦è´¹", "paid", date(2024, 9, 5)),
            ("S001", 1200.00, "ä½å®¿è´¹", "unpaid", None),
            ("S002", 8000.00, "å­¦è´¹", "paid", date(2024, 9, 3)),
            ("S002", 1200.00, "ä½å®¿è´¹", "paid", date(2024, 9, 3)),
            ("S003", 8000.00, "å­¦è´¹", "unpaid", None),
            ("S004", 8000.00, "å­¦è´¹", "paid", date(2024, 9, 10))
        ]
        cur.executemany("""
        INSERT INTO payments (student_id, amount, payment_type, status, payment_date)
        VALUES (%s, %s, %s, %s, %s)
        ON CONFLICT DO NOTHING;
        """, payment_data)
        # å¯¼å…¥å®¿èˆæ•°æ®
        dorm_data = [
            ("D001", "S001", "1å·å®¿èˆæ¥¼", 3, "302", 1, date(2022, 9, 10)),
            ("D002", "S002", "2å·å®¿èˆæ¥¼", 4, "401", 2, date(2021, 9, 10)),
            ("D003", "S003", "3å·å®¿èˆæ¥¼", 2, "205", 3, date(2022, 9, 10)),
            ("D004", "S004", "1å·å®¿èˆæ¥¼", 1, "103", 4, date(2023, 9, 10))
        ]
        cur.executemany("""
        INSERT INTO dormitory (dorm_id, student_id, building, floor, room_number, bed_number, check_in_date)
        VALUES (%s, %s, %s, %s, %s, %s, %s)
        ON CONFLICT (dorm_id) DO NOTHING;
        """, dorm_data)
        conn.commit()
        print("ä¸šåŠ¡è¡¨ä»¿çœŸæ•°æ®å¯¼å…¥å®Œæˆï¼")
        cur.close()
    except Exception as e:
        print(f"æ•°æ®å¯¼å…¥å¤±è´¥ï¼š{e}")
        if conn:
            conn.rollback()
    finally:
        if conn:
            conn.close()


if __name__ == "__main__":
    seed_business_data()
```

1. è¿è¡Œè„šæœ¬ï¼špython db/[seed_data.py](http://seed_data.py/)ï¼Œæ— æŠ¥é”™åˆ™æ•°æ®å¯¼å…¥æˆåŠŸï¼›
2. ç¼–å†™æŸ¥è¯¢è„šæœ¬éªŒè¯æ•°æ®ï¼šSELECT * FROM student_records;ï¼Œç¡®è®¤æ•°æ®æ­£ç¡®ã€‚

**æ­¥éª¤ 3ï¼šFastAPI åˆ†å±‚å¼€å‘ï¼ˆDAO/Serviceï¼‰ï¼ˆ1.5hï¼‰**

1. åœ¨api/ç›®å½•ä¸‹åˆ›å»ºdao/ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰ï¼Œåˆ›å»º[student_dao.py](http://student_dao.py/)ï¼š

```python
import psycopg2
from dotenv import load_dotenv
import os
from typing import List, Dict, Optional

load_dotenv()


class StudentDAO:
    """å­¦ç”Ÿç›¸å…³æ•°æ®è®¿é—®å±‚"""

    def __connect(self):
        return psycopg2.connect(os.getenv("SUPABASE_DB_URL"))

    def get_student_by_id(self, student_id: str) -> Optional[Dict]:
        """æ ¹æ®å­¦ç”ŸIDæŸ¥è¯¢å­¦ç±ä¿¡æ¯"""
        conn = self.__connect()
        try:
            cur = conn.cursor()
            cur.execute("""
            SELECT student_id, name, gender, grade, department, admission_date, status
            FROM student_records
            WHERE student_id = %s;
            """, (student_id,))
            row = cur.fetchone()
            if not row:
                return None
            columns = [desc[0] for desc in cur.description]
            return dict(zip(columns, row))
        finally:
            conn.close()

    def get_student_payments(self, student_id: str) -> List[Dict]:
        """æŸ¥è¯¢å­¦ç”Ÿç¼´è´¹è®°å½•"""
        conn = self.__connect()
        try:
            cur = conn.cursor()
            cur.execute("""
            SELECT payment_id, amount, payment_type, status, payment_date
            FROM payments
            WHERE student_id = %s;
            """, (student_id,))
            rows = cur.fetchall()
            columns = [desc[0] for desc in cur.description]
            return [dict(zip(columns, row)) for row in rows]
        finally:
            conn.close()

    def get_student_dormitory(self, student_id: str) -> Optional[Dict]:
        """æŸ¥è¯¢å­¦ç”Ÿå®¿èˆä¿¡æ¯"""
        conn = self.__connect()
        try:
            cur = conn.cursor()
            cur.execute("""
            SELECT dorm_id, building, floor, room_number, bed_number, check_in_date
            FROM dormitory
            WHERE student_id = %s;
            """, (student_id,))
            row = cur.fetchone()
            if not row:
                return None
            columns = [desc[0] for desc in cur.description]
            return dict(zip(columns, row))
        finally:
            conn.close()
```

1. åœ¨api/ç›®å½•ä¸‹åˆ›å»ºservices/ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰ï¼Œåˆ›å»º[student_service.py](http://student_service.py/)ï¼š

```python
from api.dao.student_dao import StudentDAO
from typing import Dict, Optional, List


class StudentService:
    """å­¦ç”Ÿç›¸å…³ä¸šåŠ¡é€»è¾‘å±‚"""

    def __init__(self):
        self.dao = StudentDAO()

    def get_student_profile(self, student_id: str) -> Optional[Dict]:
        """è·å–å­¦ç”Ÿå®Œæ•´æ¡£æ¡ˆï¼ˆå­¦ç±+ç¼´è´¹+å®¿èˆï¼‰"""
        student = self.dao.get_student_by_id(student_id)
        if not student:
            return None
        payments = self.dao.get_student_payments(student_id)
        dormitory = self.dao.get_student_dormitory(student_id)
        return {
            "student_info": student,
            "payments": payments,
            "dormitory": dormitory
        }

    def check_payment_status(self, student_id: str, payment_type: str = "ä½å®¿è´¹") -> Dict:
        """æ£€æŸ¥ç‰¹å®šç±»å‹ç¼´è´¹çŠ¶æ€"""
        payments = self.dao.get_student_payments(student_id)
        target_payment = next((p for p in payments if p["payment_type"] == payment_type), None)
        if not target_payment:
            return {"status": "not_found", "message": f"æœªæ‰¾åˆ°{payment_type}è®°å½•"}
        return {
            "status": target_payment["status"],
            "amount": target_payment["amount"],
            "payment_date": target_payment["payment_date"]
        }
```

**æ­¥éª¤ 4ï¼šFastAPI æ¥å£å¼€å‘ï¼ˆ1.5hï¼‰**

1. åœ¨api/ç›®å½•ä¸‹åˆ›å»º[main.py](http://main.py/)ï¼ˆæ¥å£å…¥å£ï¼‰ï¼š

```python
from fastapi import FastAPI, HTTPException, Query
from api.services.student_service import StudentService
from pydantic import BaseModel
from typing import Optional

app = FastAPI(title="æ™ºæ…§æ ¡å›­ä¸šåŠ¡æ¥å£", version="1.0")
service = StudentService()


# å“åº”æ¨¡å‹
class StudentProfileResponse(BaseModel):
    student_info: dict
    payments: list
    dormitory: Optional[dict]


class PaymentStatusResponse(BaseModel):
    status: str
    amount: Optional[float]
    payment_date: Optional[str]
    message: Optional[str]


@app.get("/api/student/{student_id}", response_model=StudentProfileResponse, summary="è·å–å­¦ç”Ÿå®Œæ•´æ¡£æ¡ˆ")
def get_student_profile(student_id: str):
    """æ ¹æ®å­¦ç”ŸIDè·å–å­¦ç±ã€ç¼´è´¹ã€å®¿èˆä¿¡æ¯"""
    profile = service.get_student_profile(student_id)
    if not profile:
        raise HTTPException(status_code=404, detail=f"å­¦ç”ŸID {student_id} ä¸å­˜åœ¨")
    return profile


@app.get("/api/student/{student_id}/payment", response_model=PaymentStatusResponse, summary="æ£€æŸ¥ç¼´è´¹çŠ¶æ€")
def check_payment_status(student_id: str, payment_type: str = Query("ä½å®¿è´¹", description="ç¼´è´¹ç±»å‹")):
    """æ£€æŸ¥å­¦ç”Ÿç‰¹å®šç±»å‹çš„ç¼´è´¹çŠ¶æ€ï¼ˆé»˜è®¤ï¼šä½å®¿è´¹ï¼‰"""
    status = service.check_payment_status(student_id, payment_type)
    if status["status"] == "not_found":
        raise HTTPException(status_code=404, detail=status["message"])
    return status


if __name__ == "__main__":
    import uvicorn
    uvicorn.run("api.main:app", host="0.0.0.0", port=8000, reload=True)
```

1. è¿è¡Œæ¥å£æœåŠ¡ï¼špython api/[main.py](http://main.py/)ï¼Œå¯åŠ¨æˆåŠŸåè®¿é—®http://127.0.0.1:8000/docsï¼ˆSwagger UIï¼‰ï¼›
2. åœ¨ Swagger UI ä¸­æµ‹è¯•æ¥å£ï¼š
- æµ‹è¯•/api/student/S001ï¼šè¿”å›å®Œæ•´æ¡£æ¡ˆï¼›
- æµ‹è¯•/api/student/S001/paymentï¼šæ£€æŸ¥ä½å®¿è´¹çŠ¶æ€ï¼›
- æµ‹è¯•ä¸å­˜åœ¨çš„å­¦ç”Ÿ IDï¼ˆå¦‚ S999ï¼‰ï¼šè¿”å› 404 é”™è¯¯ã€‚

**æ­¥éª¤ 5ï¼šä»£ç æäº¤ä¸ PRï¼ˆ0.5hï¼‰**

1. æäº¤ä»£ç ï¼šgit add . â†’ git commit -m "feat: å®ŒæˆSupabaseä¸šåŠ¡è¡¨è®¾è®¡ä¸FastAPIæ¥å£å¼€å‘"ï¼›
2. æ¨é€åˆ†æ”¯ï¼šgit push origin feature/day4ï¼›
3. åˆ›å»º PRï¼Œé™„ Swagger UI æ¥å£æµ‹è¯•æˆªå›¾ã€‚

**å…­ã€è€ƒæ ¸æ–¹æ³•ï¼ˆé‡åŒ–è¯„åˆ†ï¼Œ10 åˆ†ï¼‰**

| è€ƒæ ¸é¡¹ | åˆ†å€¼ | è¯„åˆ†æ ‡å‡† |
| --- | --- | --- |
| ä¸šåŠ¡è¡¨è®¾è®¡ | 3 åˆ† | ç¬¦åˆä¸‰å¤§èŒƒå¼ï¼Œå­—æ®µç±»å‹åˆç†ï¼Œç´¢å¼•è®¾è®¡æ­£ç¡® |
| æ•°æ®å¯¼å…¥ | 2 åˆ† | ä»¿çœŸæ•°æ®å¯¼å…¥æˆåŠŸï¼ŒæŸ¥è¯¢éªŒè¯æ— é—®é¢˜ |
| FastAPI æ¥å£ | 4 åˆ† | å®ç° 2 ä¸ªæ ¸å¿ƒæ¥å£ï¼ŒSwagger UI æµ‹è¯•é€šè¿‡ï¼ˆå­˜åœ¨ / ä¸å­˜åœ¨çš„å­¦ç”Ÿ ID å‡æ­£å¸¸å“åº”ï¼‰ |
| åŠ åˆ†é¡¹ | 1 åˆ† | æ¥å£æ·»åŠ è¯·æ±‚å‚æ•°æ ¡éªŒã€å“åº”æ¨¡å‹è§„èŒƒï¼Œä»£ç åˆ†å±‚æ¸…æ™°ï¼ˆDAO/Service/APIï¼‰ |

---

## Day 5ï¼šLangGraph çŠ¶æ€æŒä¹…åŒ–ï¼ˆCheckpointerï¼‰

**ä¸€ã€å‰æœŸçŸ¥è¯†ï¼ˆè¯¾å‰é¢„ä¹ ï¼Œ1hï¼‰**

1. LangGraph æ ¸å¿ƒæ¦‚å¿µï¼ˆçŠ¶æ€æœºã€èŠ‚ç‚¹ã€è¾¹ã€State å¯¹è±¡ï¼‰ï¼›
2. çŠ¶æ€æŒä¹…åŒ–çš„æ ¸å¿ƒæ„ä¹‰ï¼ˆæ–­ç‚¹ç»­ä¼ ã€çŠ¶æ€æ¢å¤ï¼‰ï¼›
3. PostgreSQL Checkpointerï¼ˆPostgresSaverï¼‰å·¥ä½œåŸç†ã€‚

**äºŒã€å®éªŒç›®æ ‡**

1. æŒæ¡ LangGraph çŠ¶æ€æœºçš„åŸºç¡€å¼€å‘æ–¹æ³•ï¼›
2. å®ç°åŸºäº PostgresSaver çš„çŠ¶æ€æŒä¹…åŒ–ï¼›
3. å®Œæˆæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼ˆæ–­å¼€é‡è¿ï¼Œè¿›åº¦ä¸ä¸¢å¤±ï¼‰ã€‚

**ä¸‰ã€éš¾ç‚¹é‡ç‚¹**

- **é‡ç‚¹**ï¼šState å¯¹è±¡è®¾è®¡ã€PostgresSaver é…ç½®ã€Thread ID å…³è”ï¼›
- **éš¾ç‚¹**ï¼šçŠ¶æ€æ¢å¤é€»è¾‘ã€Thread ID å”¯ä¸€æ€§ä¿è¯ã€çŠ¶æ€è¿‡æœŸæ¸…ç†ã€‚

**å››ã€çŸ¥è¯†åŸºç¡€**

- å¿…å¤‡ï¼šPython ç±»ä¸å­—å…¸ã€LangChain åŸºç¡€ç»„ä»¶ï¼›
- å¯é€‰ï¼šçŠ¶æ€æœºè®¾è®¡æ€æƒ³ï¼ˆæ— éœ€æ·±å…¥ï¼Œäº†è§£ â€œçŠ¶æ€æµè½¬â€ å³å¯ï¼‰ã€‚

**äº”ã€å®éªŒæ­¥éª¤ï¼ˆ8hï¼Œå« 2h ç†è®ºè®²è§£ï¼‰**

**é˜¶æ®µ 1ï¼šç†è®ºè®²è§£ï¼ˆ2hï¼‰**

1. LangGraph çŠ¶æ€æœºåŸç†ï¼šState å¯¹è±¡ï¼ˆçŠ¶æ€è½½ä½“ï¼‰ã€èŠ‚ç‚¹ï¼ˆæ‰§è¡Œé€»è¾‘ï¼‰ã€è¾¹ï¼ˆæµè½¬è§„åˆ™ï¼‰ï¼ˆ30minï¼‰ï¼›
2. çŠ¶æ€æŒä¹…åŒ–çš„å¿…è¦æ€§ï¼šæ–­ç‚¹ç»­ä¼ ã€å¤šç«¯åŒæ­¥ã€æ—¥å¿—è¿½æº¯ï¼ˆ20minï¼‰ï¼›
3. Checkpointer æ ¸å¿ƒç»„ä»¶ï¼šPostgresSaverï¼ˆå­˜å‚¨çŠ¶æ€åˆ° Supabaseï¼‰ã€Thread IDï¼ˆä¼šè¯å”¯ä¸€æ ‡è¯†ï¼‰ï¼ˆ30minï¼‰ï¼›
4. çŠ¶æ€æ¢å¤é€»è¾‘ï¼šæ ¹æ® Thread ID åŠ è½½å†å² Stateï¼Œç»§ç»­æ‰§è¡Œæµç¨‹ï¼ˆ20minï¼‰ï¼›
5. çŠ¶æ€ç®¡ç†ä¼˜åŒ–ï¼šè¿‡æœŸæ¸…ç†ã€å†—ä½™æ•°æ®åˆ é™¤ï¼ˆ20minï¼‰ã€‚

**é˜¶æ®µ 2ï¼šå®æ“è½åœ°ï¼ˆ6hï¼‰**

**æ­¥éª¤ 1ï¼šç¯å¢ƒå‡†å¤‡ï¼ˆ1hï¼‰**

1. å®‰è£… LangGraph ä¾èµ–ï¼špip install langgraph langchain-checkpoint-postgresï¼›
2. ç¡®ä¿ Supabase è¿æ¥æ­£å¸¸ï¼ˆ.envä¸­ SUPABASE_DB_URL é…ç½®æ­£ç¡®ï¼‰ã€‚

**æ­¥éª¤ 2ï¼šLangGraph åŸºç¡€çŠ¶æ€æœºå¼€å‘ï¼ˆ1.5hï¼‰**

1. åœ¨agents/ç›®å½•ä¸‹åˆ›å»º[langgraph_basic.py](http://langgraph_basic.py/)ï¼Œç¼–å†™åŸºç¡€çŠ¶æ€æœºï¼š

```python
from langgraph.graph import StateGraph
from typing import List, Dict, Optional
from pydantic import BaseModel


# 1. å®šä¹‰Stateå¯¹è±¡ï¼ˆåŒ…å«ä¼šè¯IDã€å¯¹è¯å†å²ã€å½“å‰æ­¥éª¤ã€ç”¨æˆ·ä¿¡æ¯ï¼‰
class CampusState(BaseModel):
    thread_id: str  # ä¼šè¯å”¯ä¸€æ ‡è¯†
    messages: List[Dict]  # å¯¹è¯å†å²
    current_step: str = "start"  # å½“å‰æ­¥éª¤ï¼ˆstart/identity_confirm/payment_check/dorm_query/endï¼‰
    student_id: Optional[str] = None  # å­¦ç”ŸIDï¼ˆèº«ä»½ç¡®è®¤åèµ‹å€¼ï¼‰


# 2. å®šä¹‰èŠ‚ç‚¹å‡½æ•°ï¼ˆæ‰§è¡Œé€»è¾‘ï¼‰
def start_node(state: CampusState) -> CampusState:
    """èµ·å§‹èŠ‚ç‚¹ï¼šå¼•å¯¼ç”¨æˆ·è¿›è¡Œèº«ä»½ç¡®è®¤"""
    state.messages.append({
        "role": "assistant",
        "content": "æ¬¢è¿ä½¿ç”¨æ™ºæ…§æ ¡å›­æŠ¥åˆ°ç³»ç»Ÿï¼è¯·æä¾›ä½ çš„å­¦ç”ŸIDè¿›è¡Œèº«ä»½ç¡®è®¤ï½"
    })
    state.current_step = "identity_confirm"
    return state


def identity_confirm_node(state: CampusState) -> CampusState:
    """èº«ä»½ç¡®è®¤èŠ‚ç‚¹ï¼šè·å–å­¦ç”ŸIDï¼Œæ¨¡æ‹ŸéªŒè¯"""
    # ä»ç”¨æˆ·æ¶ˆæ¯ä¸­æå–å­¦ç”ŸIDï¼ˆç®€åŒ–ï¼šç›´æ¥å–æœ€åä¸€æ¡æ¶ˆæ¯å†…å®¹ï¼‰
    user_msg = state.messages[-1]["content"]
    state.student_id = user_msg.strip()  # å‡è®¾ç”¨æˆ·ç›´æ¥è¾“å…¥å­¦ç”ŸIDï¼ˆå¦‚S001ï¼‰
    # æ¨¡æ‹Ÿèº«ä»½éªŒè¯æˆåŠŸï¼ˆå®é™…åº”è°ƒç”¨Day4çš„FastAPIæ¥å£ï¼‰
    state.messages.append({
        "role": "assistant",
        "content": f"èº«ä»½ç¡®è®¤æˆåŠŸï¼ä½ æ˜¯{state.student_id}å·å­¦ç”Ÿï¼Œæ¥ä¸‹æ¥å°†ä¸ºä½ åŠç†æŠ¥åˆ°æµç¨‹ï½"
    })
    state.current_step = "payment_check"
    return state


# 3. æ„å»ºåŸºç¡€çŠ¶æ€æœºï¼ˆæ— æŒä¹…åŒ–ï¼‰
def build_basic_graph():
    graph = StateGraph(CampusState)
    # æ·»åŠ èŠ‚ç‚¹
    graph.add_node("start", start_node)
    graph.add_node("identity_confirm", identity_confirm_node)
    # æ·»åŠ è¾¹ï¼ˆæµè½¬è§„åˆ™ï¼‰
    graph.set_entry_point("start")
    graph.add_edge("start", "identity_confirm")
    graph.add_edge("identity_confirm", "payment_check")  # åç»­å°†æ‰©å±•payment_checkèŠ‚ç‚¹
    # ç¼–è¯‘çŠ¶æ€æœº
    return graph.compile()


# æµ‹è¯•åŸºç¡€çŠ¶æ€æœº
if __name__ == "__main__":
    graph = build_basic_graph()
    # åˆå§‹åŒ–çŠ¶æ€
    initial_state = CampusState(
        thread_id="thread_001",
        messages=[{"role": "user", "content": "å¼€å§‹æŠ¥åˆ°"}]
    )
    # æ‰§è¡ŒçŠ¶æ€æœº
    result = graph.invoke(initial_state)
    print("åŸºç¡€çŠ¶æ€æœºæ‰§è¡Œç»“æœï¼š")
    for msg in result.messages:
        print(f"{msg['role']}: {msg['content']}")
    print(f"å½“å‰æ­¥éª¤ï¼š{result.current_step}")
    print(f"å­¦ç”ŸIDï¼š{result.student_id}")
```

1. è¿è¡Œè„šæœ¬ï¼Œæµ‹è¯•åŸºç¡€çŠ¶æ€æœºæµè½¬ï¼ˆstartâ†’identity_confirmï¼‰ï¼Œç¡®è®¤è¾“å‡ºæ­£ç¡®ï¼›
2. è§‚å¯Ÿ State å¯¹è±¡çš„å˜åŒ–ï¼Œç†è§£ â€œçŠ¶æ€æµè½¬â€ é€»è¾‘ã€‚

**æ­¥éª¤ 3ï¼šPostgresSaver é…ç½®ä¸çŠ¶æ€æŒä¹…åŒ–ï¼ˆ1.5hï¼‰**

1. åœ¨agents/ç›®å½•ä¸‹åˆ›å»º[langgraph_checkpoint.py](http://langgraph_checkpoint.py/)ï¼Œé…ç½® PostgresSaverï¼š

```python
from langgraph.checkpoint.postgres import PostgresSaver
from langgraph.graph import StateGraph
from dotenv import load_dotenv
import os
from agents.langgraph_basic import CampusState, start_node, identity_confirm_node

load_dotenv()


# 1. é…ç½®PostgresSaverï¼ˆè¿æ¥PostgreSQLï¼Œå­˜å‚¨çŠ¶æ€ï¼‰
def init_postgres_checkpointer() -> PostgresSaver:
    return PostgresSaver.from_conn_string(
        conn_string=os.getenv("SUPABASE_DB_URL"),
        table_name="langgraph_checkpoints"  # çŠ¶æ€å­˜å‚¨è¡¨ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
    )


# 2. æ„å»ºå¸¦æŒä¹…åŒ–çš„çŠ¶æ€æœº
def build_persistent_graph():
    checkpointer = init_postgres_checkpointer()
    graph = StateGraph(CampusState)
    # æ·»åŠ èŠ‚ç‚¹ï¼ˆå¤ç”¨åŸºç¡€çŠ¶æ€æœºçš„èŠ‚ç‚¹ï¼‰
    graph.add_node("start", start_node)
    graph.add_node("identity_confirm", identity_confirm_node)
    # æ·»åŠ è¾¹
    graph.set_entry_point("start")
    graph.add_edge("start", "identity_confirm")
    # ç¼–è¯‘çŠ¶æ€æœºï¼ˆå¯ç”¨checkpointerï¼‰
    return graph.compile(checkpointer=checkpointer)


# æµ‹è¯•çŠ¶æ€æŒä¹…åŒ–ï¼ˆé¦–æ¬¡æ‰§è¡Œï¼šå­˜å‚¨çŠ¶æ€ï¼‰
if __name__ == "__main__":
    graph = build_persistent_graph()
    thread_id = "thread_001"  # ä¼šè¯å”¯ä¸€ID
    # åˆå§‹åŒ–çŠ¶æ€
    initial_state = CampusState(
        thread_id=thread_id,
        messages=[{"role": "user", "content": "å¼€å§‹æŠ¥åˆ°"}]
    )
    # æ‰§è¡ŒçŠ¶æ€æœºï¼ˆé¦–æ¬¡æ‰§è¡Œï¼Œå­˜å‚¨çŠ¶æ€åˆ°PostgreSQLï¼‰
    result = graph.invoke(initial_state, config={"configurable": {"thread_id": thread_id}})
    print("é¦–æ¬¡æ‰§è¡Œç»“æœï¼š")
    for msg in result.messages:
        print(f"{msg['role']}: {msg['content']}")
    print(f"å½“å‰æ­¥éª¤ï¼š{result.current_step}")  # åº”ä¸ºidentity_confirm
```

1. è¿è¡Œè„šæœ¬ï¼Œé¦–æ¬¡æ‰§è¡ŒçŠ¶æ€æœºï¼Œå­˜å‚¨çŠ¶æ€åˆ° PostgreSQLï¼›
2. ç™»å½• Supabase Dashboard â†’ Table Editorï¼ŒæŸ¥çœ‹ langgraph_checkpoints è¡¨ï¼Œç¡®è®¤çŠ¶æ€æ•°æ®å·²å­˜å‚¨ã€‚

**æ­¥éª¤ 4ï¼šæ–­ç‚¹ç»­ä¼ åŠŸèƒ½å®ç°ï¼ˆ1.5hï¼‰**

1. åœ¨[langgraph_checkpoint.py](http://langgraph_checkpoint.py/)ä¸­æ·»åŠ çŠ¶æ€æ¢å¤ä¸æ–­ç‚¹ç»­ä¼ æµ‹è¯•ï¼š

```python
# æ–°å¢payment_checkèŠ‚ç‚¹ï¼ˆæ¨¡æ‹Ÿç¼´è´¹æ£€æŸ¥æ­¥éª¤ï¼‰
def payment_check_node(state: CampusState) -> CampusState:
    """ç¼´è´¹æ£€æŸ¥èŠ‚ç‚¹ï¼šæ¨¡æ‹ŸæŸ¥è¯¢ä½å®¿è´¹çŠ¶æ€"""
    state.messages.append({
        "role": "assistant",
        "content": f"æ­£åœ¨æŸ¥è¯¢{state.student_id}çš„ä½å®¿è´¹ç¼´è´¹çŠ¶æ€...\næŸ¥è¯¢ç»“æœï¼šæœªç¼´è´¹ï¼Œè¯·å®Œæˆç¼´è´¹åç»§ç»­ï½"
    })
    state.current_step = "dorm_query"
    return state


# æ›´æ–°å¸¦æŒä¹…åŒ–çš„çŠ¶æ€æœºï¼ˆæ·»åŠ payment_checkèŠ‚ç‚¹ï¼‰
def build_persistent_graph():
    checkpointer = init_postgres_checkpointer()
    graph = StateGraph(CampusState)
    # æ·»åŠ èŠ‚ç‚¹
    graph.add_node("start", start_node)
    graph.add_node("identity_confirm", identity_confirm_node)
    graph.add_node("payment_check", payment_check_node)  # æ–°å¢èŠ‚ç‚¹
    # æ·»åŠ è¾¹
    graph.set_entry_point("start")
    graph.add_edge("start", "identity_confirm")
    graph.add_edge("identity_confirm", "payment_check")
    graph.add_edge("payment_check", "dorm_query")
    # ç¼–è¯‘çŠ¶æ€æœº
    return graph.compile(checkpointer=checkpointer)
```