# CampusFlow 智慧校园多智能体系统 - 教学计划

## 📋 课程信息

**课程周期**：10 天（核心实训）
**适用对象**：计算机 / AI 相关专业大三 / 大四学生（前置基础：Python 基础、简单 SQL、Git 基本使用）
**核心交付**：可公网访问的智慧校园多智能体系统（Vercel 部署）

---

## 📚 教学资源目录

本课程的教学资源已整理在 `docs/` 目录下，按类别分类：

### 📁 docs/ 目录结构

```
docs/
├── README.md                      # 文档目录说明
├── 教学文件/                     # 教学相关文档和测试材料
│   ├── ragfiles/                 # RAG 测试文档（PDF、Word、Excel）
│   └── neo4j知识图谱.md         # Neo4j 知识图谱教学文档
├── 测试报告/                     # 项目测试报告
│   ├── 测试报告-Day1-Day2.md   # Day 1-2 综合测试报告
│   └── RAG测试报告-真实文档.md  # RAG 真实文档测试报告
└── 知识点补充/                    # 补充知识点和学习指南
    ├── Git-GitHub使用指南.md     # Git 和 GitHub 使用指南
    └── 环境配置指南.md             # Python 虚拟环境配置指南
```

### 📚 教学材料说明

#### 教学文件 (`docs/教学文件/`)

**RAG 测试文档** (`ragfiles/`)：
- `2025年本科新生报到手册.pdf` - 新生报到详细指南（20.53 MB）
- `东华大学学生违纪处分规定.pdf` - 学生违纪处理规定（0.57 MB）
- `东华大学2026年硕士研究生招生简章.docx` - 硕士研究生招生信息（0.02 MB）
- `院校简介.docx` - 学校基本情况介绍（0.02 MB）
- `院系设置及重点实验室.xlsx` - 院系和实验室信息（0.02 MB）

**Neo4j 知识图谱教学文档**：
- `neo4j知识图谱.md` - Neo4j 图数据库、Cypher 查询、Text-to-Cypher 教学材料

#### 测试报告 (`docs/测试报告/`)

- `测试报告-Day1-Day2.md` - Day 1-2 的综合测试报告
  - Day 1: Supabase 数据库连接测试
  - Day 2: RAG 向量库基础功能测试

- `RAG测试报告-真实文档.md` - 使用真实文档构建 RAG 的完整测试报告
  - 文档加载测试
  - 文档切分测试
  - 数据统计
  - 技术实现说明

#### 知识点补充 (`docs/知识点补充/`)

- `Git-GitHub使用指南.md` - Git 和 GitHub 的使用指南
  - Git 基础命令
  - GitHub 工作流
  - 分支管理
  - 提交规范

- `环境配置指南.md` - Python 虚拟环境配置指南
  - uv venv 使用
  - 依赖安装
  - 环境变量配置

---

## 📅 课程大纲（按天）

### Day 1：项目启动与工程化初探

#### 一、前期知识（课前预习，1h）

**参考资料**：
- `docs/知识点补充/环境配置指南.md` - 环境配置基础知识
- `docs/知识点补充/Git-GitHub使用指南.md` - Git 基础操作

1. Git 基础操作（clone/commit/push/branch）；
2. 前后端分离项目的目录结构设计；
3. 云数据库（Supabase）的基本概念（项目 / 表 / 连接）。

#### 二、实验目标

1. 掌握企业级项目的工程化规范（Git Flow、目录结构）；
2. 完成项目初始化与云端环境（Supabase）搭建；
3. 实现本地与云端数据库的连接与基础数据操作。

#### 三、难点重点

- **重点**：Git Flow 工作流落地、项目目录结构设计、云数据库连接；
- **难点**：Supabase 环境配置、数据库连接参数调试（避免因网络 / 权限导致连接失败）。

#### 四、知识基础

- **必备**：Python 虚拟环境使用（uv venv/conda）、SQL 基本查询语句；
- **可选**：FastAPI 基础（无需深入，了解接口概念即可）。

#### 五、实验步骤（8h，含 2h 理论讲解）

**阶段 1：理论讲解（2h）**

1. 多智能体系统（MAS）核心设计模式（15min）；
2. 分布式状态管理核心问题（15min）；
3. 工程化规范：Git Flow（主干 / 开发 / 特性分支）、Commit 规范（Conventional Commits）（30min）；
4. 项目目录结构设计（前后端分离、分层架构）（30min）；
5. Supabase 云环境搭建流程演示（30min）。

**阶段 2：实操落地（6h）**

**步骤 1：项目初始化（1.5h）**

1. 从实训沙盒模板创建 GitHub 仓库（提供模板地址）；
2. 克隆仓库到本地；

3. **创建 Python 虚拟环境（重要！）**：

   本项目使用 **uv** 管理虚拟环境和依赖，uv 比传统 pip 快 10-100 倍。

   ```bash
   # 创建虚拟环境（使用 uv）
   uv venv
   ```

   激活虚拟环境：

   ```bash
   # Windows
   .venv\Scripts\activate

   # Mac/Linux
   source .venv/bin/activate
   ```

   激活成功后，命令行前会显示 `(.venv)` 标识。

4. **安装依赖（国内镜像加速）**：

   ```bash
   # 使用清华镜像源（推荐国内用户使用）
   uv pip install -r requirements.txt --index-url https://pypi.tuna.tsinghua.edu.cn/simple

   # 或使用阿里云镜像
   uv pip install -r requirements.txt --index-url https://mirrors.aliyun.com/pypi/simple/
   ```

   主要依赖包：supabase、psycopg2-binary、fastapi、uvicorn、python-dotenv

   > 💡 **提示**：如果 uv 安装较慢，可在后面添加 `-v` 参数查看详细进度

5. 按标准目录结构创建文件夹：api/（接口）、agents/（智能体）、db/（数据库）、utils/（工具函数）、.env（环境变量）。

**步骤 2：Git 配置（1h）**

1. 创建开发分支：git checkout -b dev，再创建特性分支：git checkout -b feature/day1；
2. 配置.gitignore文件（添加.venv/、.env、__pycache__/等）；
3. 编写 Commit 规范示例（如：feat: 初始化项目目录结构、docs: 添加README说明）。

**步骤 3：云端环境搭建（1.5h）**

1. 注册 / 登录 Supabase 账号（https://supabase.com）；
2. 创建新项目，记录连接信息（SUPABASE_URL、SUPABASE_KEY、SUPABASE_DB_URL）；
3. 在本地项目根目录创建.env文件，粘贴连接信息：

   ```
   SUPABASE_URL="https://your-project.supabase.co"
   SUPABASE_KEY="your-anon-key"
   SUPABASE_DB_URL="postgresql://postgres:[password]@db.your-project.supabase.co:5432/postgres"
   ```

**步骤 4：数据库连接测试（1.5h）**

1. 在db/目录下创建[connect.py](http://connect.py/)，编写 Supabase 连接代码：

   ```python
   import os
   from dotenv import load_dotenv
   from supabase import create_client

   load_dotenv()

   def connect_supabase():
       """连接 Supabase 数据库并执行基础测试"""
       try:
           # 创建 Supabase 客户端
           supabase = create_client(
               os.getenv("SUPABASE_URL"),
               os.getenv("SUPABASE_KEY")
           )
           print("✅ Supabase 连接成功！")
           
           # 测试查询
           response = supabase.table('test').select("*").execute()
           print("📊 查询结果:", response.data)
           
           return True
       except Exception as e:
           print(f"❌ 连接失败: {e}")
           return False

   if __name__ == "__main__":
       connect_supabase()
   ```

1. 运行脚本：python db/[connect.py](http://connect.py/)，确保输出 "Supabase 连接成功" 及查询结果；
2. 若失败，按错误提示调试（如：检查连接地址、API Key、依赖安装）。

**步骤 5：代码提交与 PR（0.5h）**

1. 提交代码：git add . → git commit -m "feat: 完成项目初始化与Supabase连接测试"；
2. 推送分支：git push origin feature/day1；
3. 在 GitHub 仓库创建 Pull Request（base: dev，compare: feature/day1），填写 PR 说明。

#### 六、考核方法（量化评分，10 分）

| 考核项 | 分值 | 评分标准 |
| --- | --- | --- |
| 虚拟环境配置 | 2 分 | 成功创建并激活 venv，命令行显示 (venv) 标识，依赖安装无报错 |
| 项目目录结构 | 2 分 | 符合标准结构（api/agents/db/utils），无冗余文件 |
| Git 配置 | 3 分 | 分支创建正确（dev/feature/day1），.gitignore 配置合理，Commit 规范 |
| 数据库连接 | 3 分 | 成功运行 connect.py，输出 Supabase 连接成功及查询结果，无报错 |
| 加分项 | 1 分 | 提交 PR 并填写规范说明，代码注释清晰 |

---

### Day 2：知识获取（RAG + 向量库）

#### 一、前期知识（课前预习，1h）

**参考资料**：
- `docs/测试报告/RAG测试报告-真实文档.md` - RAG 测试报告
- `docs/教学文件/ragfiles/` - RAG 测试文档（真实文档）

1. RAG 核心流程（加载 - 切分 - 向量化 - 存储 - 检索）；
2. 向量库的基本概念（Embedding、相似度匹配）；
3. LangChain 的基础组件（Loader、Splitter、Embeddings）。

#### 二、实验目标

1. 掌握语义切分的原则与实操方法；
2. 实现基于 Chroma 的向量库构建（文本加载→向量化→存储）；
3. 完成基础 RAG 检索（语义 / 关键词 / 混合检索）并验证效果。

#### 三、难点重点

- **重点**：语义切分参数调整、Embedding 模型选择、RAG 检索流程；
- **难点**：语义切分后语义完整性保证、检索结果准确率优化。

#### 四、知识基础

- **必备**：Python 文件操作、JSON / 字典处理；
- **可选**：NLP 基础（词向量概念，无需深入）。

#### 五、实验步骤（8h，含 2h 理论讲解）

**阶段 1：理论讲解（2h）**

1. RAG 全流程解析（加载 - 切分 - 向量化 - 存储 - 检索 - 生成）（30min）；
2. 语义切分原则：chunk_size/chunk_overlap 配置逻辑，避免语义断裂（30min）；
3. 混合检索策略：关键词检索（精确匹配）+ 语义检索（模糊匹配）（20min）；
4. Chroma DB 特性与 LangChain 集成方法（20min）；
5. 开源 Embedding 模型选择（BGE-m3，轻量高效适配实训）（20min）。

**阶段 2：实操落地（6h）**

**步骤 1：环境准备（1h）**

1. 激活虚拟环境，安装新增依赖（使用国内镜像加速）：

   ```bash
   uv pip install langchain langchain-core langchain-community chromadb sentence-transformers python-dotenv --index-url https://pypi.tuna.tsinghua.edu.cn/simple
   ```

2. 下载实训提供的《校园报到手册》（PDF 文件），放入data/目录（新建 data 文件夹）。

**步骤 2：文本加载与语义切分（1.5h）**

1. 在utils/目录下创建[rag_utils.py](http://rag_utils.py/)，编写文本处理函数：

   ```python
   from langchain_community.document_loaders import PyPDFLoader
   from langchain_text_splitters import RecursiveCharacterTextSplitter

   def load_and_split_doc():
       # 加载PDF
       loader = PyPDFLoader("data/校园报到手册.pdf")
       documents = loader.load()
       # 语义切分（chunk_size=500，chunk_overlap=50，可调整）
       text_splitter = RecursiveCharacterTextSplitter(
           chunk_size=500,
           chunk_overlap=50,
           length_function=len,
           separators=["\n\n", "\n", ". ", " ", ""]
       )
       splits = text_splitter.split_documents(documents)
       print(f"切分后文本块数量：{len(splits)}")
       return splits

   if __name__ == "__main__":
       load_and_split_doc()
   ```

1. 运行脚本：python utils/[rag_utils.py](http://rag_utils.py/)，查看切分后的文本块数量，手动检查前 3 个文本块，确保语义完整。

**步骤 3：向量化与 Chroma 存储（1.5h）**

1. 在[rag_utils.py](http://rag_utils.py/)中添加向量化与存储函数：

   ```python
   from langchain_community.embeddings import SentenceTransformerEmbeddings
   from langchain_community.vectorstores import Chroma

   def init_chroma_db(splits):
       # 初始化开源Embedding模型（BGE-m3）
       embedding = SentenceTransformerEmbeddings(model_name="BAAI/bge-m3")
       # 创建Chroma向量库（本地存储，路径：db/chroma_db）
       db = Chroma.from_documents(
           documents=splits,
           embedding=embedding,
           persist_directory="db/chroma_db"
       )
       db.persist()
       print("Chroma向量库初始化完成！")
       return db

   if __name__ == "__main__":
       splits = load_and_split_doc()
       init_chroma_db(splits)
   ```

1. 运行脚本，等待模型下载与向量库构建（首次运行较慢，耐心等待）；
2. 检查db/chroma_db目录，确认生成向量库文件（chroma.sqlite3 等）。

**步骤 4：基础检索实现（1.5h）**

1. 在[rag_utils.py](http://rag_utils.py/)中添加检索函数：

   ```python
   def retrieve_from_chroma(query, k=3):
       # 加载已构建的Chroma向量库
       embedding = SentenceTransformerEmbeddings(model_name="BAAI/bge-m3")
       db = Chroma(
           persist_directory="db/chroma_db",
           embedding_function=embedding
       )
       # 1. 语义检索（相似度匹配）
       semantic_results = db.similarity_search(query, k=k)
       print("\n=== 语义检索结果 ===")
       for i, doc in enumerate(semantic_results):
           print(f"{i+1}. 内容：{doc.page_content[:100]}...")
           print(f"   来源：{doc.metadata}")
       # 2. 混合检索（关键词+语义，基于mmr重排序）
       hybrid_results = db.max_marginal_relevance_search(query, k=k, fetch_k=10)
       print("\n=== 混合检索结果 ===")
       for i, doc in enumerate(hybrid_results):
           print(f"{i+1}. 内容：{doc.page_content[:100]}...")
           print(f"   来源：{doc.metadata}")
       return semantic_results, hybrid_results

   if __name__ == "__main__":
       splits = load_and_split_doc()
       db = init_chroma_db(splits)
       # 测试查询（例如："报到需要带什么材料？"）
       retrieve_from_chroma("报到需要带什么材料？")
   ```

1. 运行脚本，输入 3 个不同的测试查询（如报到材料、缴费标准、宿舍分配），对比语义检索与混合检索的结果差异；
2. 调整chunk_size/chunk_overlap参数，重新运行并观察检索结果变化（优化准确率）。

**步骤 5：代码提交与 PR（0.5h）**

1. 提交代码：git add . → git commit -m "feat: 完成RAG向量库构建与检索功能"；
2. 推送分支：git push origin feature/day2；
3. 创建 PR（base: dev，compare: feature/day2），附检索结果截图。

#### 六、考核方法（量化评分，10 分）

| 考核项 | 分值 | 评分标准 |
| --- | --- | --- |
| 文本切分 | 2 分 | 切分参数合理，文本块语义完整，无断裂 |
| 向量库构建 | 3 分 | 成功生成 Chroma 向量库，无报错，文件完整 |
| 检索功能 | 4 分 | 实现语义 + 混合检索，测试 3 个查询均能返回相关结果 |
| 加分项 | 1 分 | 优化切分参数提升检索准确率，提交参数对比分析 |

---

### Day 3-10：后续课程大纲

由于篇幅限制，Day 3-10 的详细内容请参考以下方式获取：

#### Day 3：复杂关系处理（知识图谱 Neo4j）

**参考资料**：`docs/教学文件/neo4j知识图谱.md`

- **核心内容**：Neo4j 图数据库、Cypher 查询、Text-to-Cypher
- **实验目标**：构建智慧校园知识图谱，实现多跳查询
- **详细步骤**：请参考 `docs/教学文件/neo4j知识图谱.md`

#### Day 4：业务数据库设计（Supabase）

- **核心内容**：关系型数据库设计、FastAPI 分层开发（DAO/Service/API）
- **实验目标**：设计业务表，实现 FastAPI 接口
- **详细步骤**：参考 CODEBUDDY.md 中的数据库设计部分

#### Day 5：LangGraph 状态持久化（Checkpointer）

- **核心内容**：LangGraph 状态机、PostgresSaver、断点续传
- **实验目标**：实现状态持久化，支持断点续传
- **详细步骤**：参考 CODEBUDDY.md 中的 LangGraph 部分

#### Day 6：RAG 智能体开发

- **核心内容**：RAG Agent、上下文管理、回答生成
- **实验目标**：开发 RAG 智能体，实现问答功能
- **详细步骤**：参考 CODEBUDDY.md 中的智能体开发部分

#### Day 7：知识图谱智能体开发

- **核心内容**：GraphCypherQAChain、Cypher 查询优化
- **实验目标**：开发知识图谱智能体，实现复杂查询
- **详细步骤**：参考 CODEBUDDY.md 中的知识图谱部分

#### Day 8：意图识别与编排器开发

- **核心内容**：Orchestrator、意图分类、路由逻辑
- **实验目标**：开发意图识别，实现智能路由
- **详细步骤**：参考 CODEBUDDY.md 中的编排器部分

#### Day 9：前端开发（Gradio）

- **核心内容**：Gradio 界面开发、对话组件、事件绑定、流式输出
- **实验目标**：开发智慧校园助手前端界面，实现对话交互
- **详细步骤**：
  1. 学习 Gradio 基础组件（Chatbot、Textbox、Button）
  2. 实现对话界面布局（左侧对话区、右侧控制面板）
  3. 绑定事件处理函数（消息发送、快捷按钮、清空历史）
  4. 实现流式响应展示（打字机效果）
  5. 添加快捷查询按钮和示例问题
  6. 参考 `docs/知识点补充/Gradio前端开发指南.md`

#### Day 10：Docker 生产部署与 CI/CD

- **核心内容**：Docker 容器化、docker-compose编排、GitHub Actions CI/CD、生产部署
- **实验目标**：将系统容器化并部署到云服务器公网访问
- **详细步骤**：
  1. 学习 Docker 基础（镜像、容器、Dockerfile）
  2. 编写多阶段 Dockerfile（优化镜像体积）
  3. 配置 docker-compose.yml（API、前端、ChromaDB、Redis）
  4. 配置生产环境 docker-compose.prod.yml
  5. 编写 GitHub Actions 工作流（代码检查→测试→构建镜像）
  6. 在云服务器安装 Docker 和 Docker Compose
  7. 配置环境变量和 SSL 证书
  8. 部署到公网并测试
  9. 参考 `docs/DEPLOY.md` 和 `docs/知识点补充/Docker容器化部署指南.md`

---

## 📝 教学计划使用说明

### 1. 教师使用

- **课前准备**：查看 `docs/教学文件/` 中的教学文档和测试材料
- **教学演示**：参考 `docs/测试报告/` 中的测试结果
- **知识点补充**：根据学生反馈，使用 `docs/知识点补充/` 中的资料进行补充讲解

### 2. 学生使用

- **课前预习**：
  - 阅读 `docs/知识点补充/` 中的相关指南
  - 查看 `docs/教学文件/` 中的测试材料，了解课程内容
- **课后复习**：
  - 参考 `docs/测试报告/` 中的测试报告，对比自己的结果
  - 使用 `docs/教学文件/ragfiles/` 中的真实文档进行练习

### 3. 查找资源

- **查看文档目录**：`cat docs/README.md`
- **查找特定文档**：使用 `ls -R docs/` 查看完整文件列表
- **快速跳转**：使用文档中的相对路径快速定位

### 4. 知识点补充文档

| 文档 | 内容 | 适用场景 |
|------|------|----------|
| `docs/知识点补充/FastAPI基础入门.md` | FastAPI 后端开发 | Day 4 学习 |
| `docs/知识点补充/LangGraph多智能体系统.md` | LangGraph 工作流 | Day 5-8 学习 |
| `docs/知识点补充/Neo4j图数据库与知识图谱.md` | Neo4j 和 Cypher | Day 3 学习 |
| `docs/知识点补充/Gradio前端开发指南.md` | Gradio 界面开发 | Day 9 学习 |
| `docs/知识点补充/MCP模型上下文协议.md` | MCP 协议 | Day 8 学习 |
| `docs/知识点补充/Docker容器化部署指南.md` | Docker 部署 | Day 10 学习 |

---

## 🚀 快速开始

### 1. 查看文档目录

```bash
# 查看文档目录说明
cat docs/README.md

# 查看完整目录结构
ls -R docs/
```

### 2. 查看教学文件

```bash
# 查看 RAG 测试文档
ls docs/教学文件/ragfiles/

# 查看 Neo4j 教学文档
cat docs/教学文件/neo4j知识图谱.md
```

### 3. 查看测试报告

```bash
# 查看 Day 1-2 测试报告
cat docs/测试报告/测试报告-Day1-Day2.md

# 查看 RAG 测试报告
cat docs/测试报告/RAG测试报告-真实文档.md
```

### 4. 学习知识点

```bash
# 查看 Git 使用指南
cat docs/知识点补充/Git-GitHub使用指南.md

# 查看环境配置指南
cat docs/知识点补充/环境配置指南.md
```

---

## 📊 学习进度跟踪

### Day 1：项目启动
- [ ] Git 基础操作
- [ ] 项目初始化
- [ ] Supabase 环境搭建
- [ ] 数据库连接测试
- [ ] 代码提交与 PR

### Day 2：RAG 向量库
- [ ] 环境准备
- [ ] 文本加载与切分
- [ ] 向量库构建
- [ ] 检索功能实现
- [ ] 代码提交与 PR

### Day 3-10：后续课程
（详细内容请参考 CODEBUDDY.md 和相关教学文档）

---

## 📚 参考资料

### 项目文档
- `CODEBUDDY.md` - 项目开发指南
- `README.md` - 项目说明文档

### 教学文档
- `docs/教学文件/` - 教学相关文档和测试材料
- `docs/测试报告/` - 各阶段的测试报告
- `docs/知识点补充/` - 补充知识点和学习指南

### 工具文档
- LangChain 官方文档：https://python.langchain.com/
- LangGraph 官方文档：https://langchain-ai.github.io/langgraph/
- ChromaDB 官方文档：https://docs.trychroma.com/
- Neo4j 官方文档：https://neo4j.com/docs/

---

**教学计划更新时间**：2026-01-30
**教学计划维护者**：CampusFlow 项目组
